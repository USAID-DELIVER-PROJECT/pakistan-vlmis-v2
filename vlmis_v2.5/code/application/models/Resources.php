<?php

/**
 * Model_Resources
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Logistics Management Information System for Vaccines
 * @subpackage Inventory Management
 * @author     Ajmal Hussain <ajmaleyetii@gmail.com>
 * @version    2
 */
class Model_Resources extends Model_Base {

    protected $_table;

    public function __construct() {
        parent::__construct();
        $this->_table = $this->_em->getRepository('Resources');
    }

    public function getResources($order = null, $sort = null) {
        if (!empty($this->form_values['only_childs'])) {
            $only_childs = $this->form_values['only_childs'];
            unset($this->form_values['only_childs']);
        }

        if (!empty($this->form_values)) {
            return $this->_table->findBy($this->form_values);
        } else {
            $qry = $this->_em->createQueryBuilder()
                    ->select("r")
                    ->from("Resources", "r")
                    ->join("r.resourceType", "rt")
                    ->where("rt.pkId IN (1,3)");
            if (!empty($only_childs)) {
                $qry->andWhere("r.parentId <> 0");
            }
            //if (!empty($this->form_values['resource_name'])) {
            //  $qry->andWhere("r.resourceName LIKE '%".$this->form_values['resource_name']."%'");
            //}
            if ($order == 'resource_name') {
                $qry->orderBy("r.resourceName", $sort);
            }
            if ($order == 'description') {
                $qry->orderBy("r.description", $sort);
            }
            if ($order == 'resource-type') {
                $qry->orderBy("rt.pkId", $sort);
            }
            if ($order == 'level') {
                $qry->orderBy("r.level", $sort);
            }
            return $qry->getQuery()->getResult();
        }
    }

    public function getAllResources() {

        $qry = $this->_em->createQueryBuilder()
                ->select("r")
                ->from("Resources", "r");
        if (!empty($this->form_values['resourceName'])) {
            $qry->where("r.resourceName= '" . $this->form_values['resourceName'] . "' ");
        }
        if (!empty($this->form_values['resourceType'])) {
            $qry->andWhere("r.resourceType=" . $this->form_values['resourceType']);
        }
        $qry->orderBy("r.resourceName", "ASC");
        $qry->addOrderBy("r.description", "ASC");


        return $qry->getQuery()->getResult();
    }

}
