var globalActiveDHTMLGridObject;String.prototype._dhx_trim=function(){return this.replace(/&nbsp;/g," ").replace(/(^[ \t]*)|([ \t]*$)/g,"")};function dhtmlxArray(A){return dhtmlXHeir((A||new Array()),dhtmlxArray._master)}dhtmlxArray._master={_dhx_find:function(B){for(var A=0;A<this.length;A++){if(B==this[A]){return A}}return -1},_dhx_insertAt:function(C,B){this[this.length]=null;for(var A=this.length-1;A>=C;A--){this[A]=this[A-1]}this[C]=B},_dhx_removeAt:function(A){this.splice(A,1)},_dhx_swapItems:function(A,C){var B=this[A];this[A]=this[C];this[C]=B}};function dhtmlXGridObject(id){if(_isIE){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}if(id){if(typeof (id)=="object"){this.entBox=id;this.entBox.id="cgrid2_"+this.uid()}else{this.entBox=document.getElementById(id)}}else{this.entBox=document.createElement("DIV");this.entBox.id="cgrid2_"+this.uid()}this.entBox.innerHTML="";dhtmlxEventable(this);var self=this;this._wcorr=0;this.cell=null;this.row=null;this.iconURL="";this.editor=null;this._f2kE=true;this._dclE=true;this.combos=new Array(0);this.defVal=new Array(0);this.rowsAr={};this.rowsBuffer=dhtmlxArray();this.rowsCol=dhtmlxArray();this._data_cache={};this._ecache={};this._ud_enabled=true;this.xmlLoader=new dtmlXMLLoaderObject(this.doLoadDetails,this,true,this.no_cashe);this._maskArr=[];this.selectedRows=dhtmlxArray();this.UserData={};this._sizeFix=this._borderFix=0;this.entBox.className+=" gridbox";this.entBox.style.width=this.entBox.getAttribute("width")||(window.getComputedStyle?(this.entBox.style.width||window.getComputedStyle(this.entBox,null)["width"]):(this.entBox.currentStyle?this.entBox.currentStyle.width:this.entBox.style.width||0))||"100%";this.entBox.style.height=this.entBox.getAttribute("height")||(window.getComputedStyle?(this.entBox.style.height||window.getComputedStyle(this.entBox,null)["height"]):(this.entBox.currentStyle?this.entBox.currentStyle.height:this.entBox.style.height||0))||"100%";this.entBox.style.cursor="default";this.entBox.onselectstart=function(){return false};var t_creator=function(name){var t=document.createElement("TABLE");t.cellSpacing=t.cellPadding=0;t.style.cssText="width:100%;table-layout:fixed;";t.className=name.substr(2);return t};this.obj=t_creator("c_obj");this.hdr=t_creator("c_hdr");this.hdr.style.marginRight="20px";this.hdr.style.paddingRight="20px";this.objBox=document.createElement("DIV");this.objBox.style.width="100%";this.objBox.style.overflow="auto";this.objBox.appendChild(this.obj);this.objBox.className="objbox";this.hdrBox=document.createElement("DIV");this.hdrBox.style.width="100%";this.hdrBox.style.height="25px";this.hdrBox.style.overflow="hidden";this.hdrBox.className="xhdr";this.preloadImagesAr=new Array(0);this.sortImg=document.createElement("IMG");this.sortImg.style.display="none";this.hdrBox.appendChild(this.sortImg);this.hdrBox.appendChild(this.hdr);this.hdrBox.style.position="relative";this.entBox.appendChild(this.hdrBox);this.entBox.appendChild(this.objBox);this.entBox.grid=this;this.objBox.grid=this;this.hdrBox.grid=this;this.obj.grid=this;this.hdr.grid=this;this.cellWidthPX=[];this.cellWidthPC=[];this.cellWidthType=this.entBox.cellwidthtype||"px";this.delim=this.entBox.delimiter||",";this._csvDelim=",";this.hdrLabels=[];this.columnIds=[];this.columnColor=[];this._hrrar=[];this.cellType=dhtmlxArray();this.cellAlign=[];this.initCellWidth=[];this.fldSort=[];this._srdh=(_isIE&&(document.compatMode!="BackCompat")?24:20);this.imgURL=window.dhx_globalImgPath||"";this.isActive=false;this.isEditable=true;this.useImagesInHeader=false;this.pagingOn=false;this.rowsBufferOutSize=0;dhtmlxEvent(window,"unload",function(){try{if(self.destructor){self.destructor()}}catch(e){}});this.setSkin=function(name){this.skin_name=name;this.entBox.className="gridbox gridbox_"+name;this.skin_h_correction=0;this.enableAlterCss("ev_"+name,"odd_"+name,this.isTreeGrid());this._fixAlterCss();switch(name){case"clear":this._topMb=document.createElement("DIV");this._topMb.className="topMumba";this._topMb.innerHTML="<img style='left:0px'   src='"+this.imgURL+"skinC_top_left.gif'><img style='right:20px' src='"+this.imgURL+"skinC_top_right.gif'>";this.entBox.appendChild(this._topMb);this._botMb=document.createElement("DIV");this._botMb.className="bottomMumba";this._botMb.innerHTML="<img style='left:0px'   src='"+this.imgURL+"skinD_bottom_left.gif'><img style='right:20px' src='"+this.imgURL+"skinD_bottom_right.gif'>";this.entBox.appendChild(this._botMb);this.entBox.style.position="relative";this.skin_h_correction=20;break;case"dhx_skyblue":case"glassy_blue":case"dhx_black":case"dhx_blue":case"modern":case"light":this._srdh=20;this.forceDivInHeader=true;break;case"xp":this.forceDivInHeader=true;if((_isIE)&&(document.compatMode!="BackCompat")){this._srdh=25}else{this._srdh=22}break;case"mt":if((_isIE)&&(document.compatMode!="BackCompat")){this._srdh=25}else{this._srdh=22}break;case"gray":if((_isIE)&&(document.compatMode!="BackCompat")){this._srdh=22}break;case"sbdark":break}if(_isIE&&this.hdr){var d=this.hdr.parentNode;d.removeChild(this.hdr);d.appendChild(this.hdr)}this.setSizes()};if(_isIE){this.preventIECaching(true)}if(window.dhtmlDragAndDropObject){this.dragger=new dhtmlDragAndDropObject()}this._doOnScroll=function(e,mode){this.callEvent("onScroll",[this.objBox.scrollLeft,this.objBox.scrollTop]);this.doOnScroll(e,mode)};this.doOnScroll=function(e,mode){this.hdrBox.scrollLeft=this.objBox.scrollLeft;if(this.ftr){this.ftr.parentNode.scrollLeft=this.objBox.scrollLeft}if(mode){return }if(this._srnd){if(this._dLoadTimer){window.clearTimeout(this._dLoadTimer)}this._dLoadTimer=window.setTimeout(function(){self._update_srnd_view()},100)}};this.attachToObject=function(obj){obj.appendChild(this.globalBox?this.globalBox:this.entBox);this.setSizes()};this.init=function(fl){if((this.isTreeGrid())&&(!this._h2)){this._h2=new dhtmlxHierarchy();if((this._fake)&&(!this._realfake)){this._fake._h2=this._h2}this._tgc={imgURL:null}}if(!this._hstyles){return }this.editStop();this.lastClicked=null;this.resized=null;this.fldSorted=this.r_fldSorted=null;this.cellWidthPX=[];this.cellWidthPC=[];if(this.hdr.rows.length>0){this.clearAll(true)}var hdrRow=this.hdr.insertRow(0);for(var i=0;i<this.hdrLabels.length;i++){hdrRow.appendChild(document.createElement("TH"));hdrRow.childNodes[i]._cellIndex=i;hdrRow.childNodes[i].style.height="0px"}if(_isIE&&_isIE<8){hdrRow.style.position="absolute"}else{hdrRow.style.height="auto"}var hdrRow=this.hdr.insertRow(_isKHTML?2:1);hdrRow._childIndexes=new Array();var col_ex=0;for(var i=0;i<this.hdrLabels.length;i++){hdrRow._childIndexes[i]=i-col_ex;if((this.hdrLabels[i]==this.splitSign)&&(i!=0)){if(_isKHTML){hdrRow.insertCell(i-col_ex)}hdrRow.cells[i-col_ex-1].colSpan=(hdrRow.cells[i-col_ex-1].colSpan||1)+1;hdrRow.childNodes[i-col_ex-1]._cellIndex++;col_ex++;hdrRow._childIndexes[i]=i-col_ex;continue}hdrRow.insertCell(i-col_ex);hdrRow.childNodes[i-col_ex]._cellIndex=i;hdrRow.childNodes[i-col_ex]._cellIndexS=i;this.setColumnLabel(i,this.hdrLabels[i])}if(col_ex==0){hdrRow._childIndexes=null}this._cCount=this.hdrLabels.length;if(_isIE){window.setTimeout(function(){self.setSizes()},1)}if(!this.obj.firstChild){this.obj.appendChild(document.createElement("TBODY"))}var tar=this.obj.firstChild;if(!tar.firstChild){tar.appendChild(document.createElement("TR"));tar=tar.firstChild;if(_isIE&&_isIE<8){tar.style.position="absolute"}else{tar.style.height="auto"}for(var i=0;i<this.hdrLabels.length;i++){tar.appendChild(document.createElement("TH"));tar.childNodes[i].style.height="0px"}}this._c_order=null;if(this.multiLine!=true){this.obj.className+=" row20px"}this.sortImg.style.position="absolute";this.sortImg.style.display="none";this.sortImg.src=this.imgURL+"sort_desc.gif";this.sortImg.defLeft=0;if(this.noHeader){this.hdrBox.style.display="none"}else{this.noHeader=false}if(this._ivizcol){this.setColHidden()}this.attachHeader();this.attachHeader(0,0,"_aFoot");this.setSizes();if(fl){this.parseXML()}this.obj.scrollTop=0;if(this.dragAndDropOff){this.dragger.addDragLanding(this.entBox,this)}if(this._initDrF){this._initD()}if(this._init_point){this._init_point()}};this.setColumnSizes=function(gridWidth){var summ=0;var fcols=[];for(var i=0;i<this._cCount;i++){if((this.initCellWidth[i]=="*")&&!this._hrrar[i]){this._awdth=false;fcols.push(i);continue}if(this.cellWidthType=="%"){if(typeof this.cellWidthPC[i]=="undefined"){this.cellWidthPC[i]=this.initCellWidth[i]}this.cellWidthPX[i]=Math.floor(gridWidth*this.cellWidthPC[i]/100)||0}else{if(typeof this.cellWidthPX[i]=="undefined"){this.cellWidthPX[i]=this.initCellWidth[i]}}if(!this._hrrar[i]){summ+=this.cellWidthPX[i]*1}}if(fcols.length){var ms=Math.floor((gridWidth-summ)/fcols.length);if(ms<0){ms=1}for(var i=0;i<fcols.length;i++){var next=Math.max((this._drsclmW?this._drsclmW[fcols[i]]:0),ms);this.cellWidthPX[fcols[i]]=next;summ+=next}if(gridWidth>summ){var last=fcols[fcols.length-1];this.cellWidthPX[last]=this.cellWidthPX[last]+(gridWidth-summ);summ=gridWidth}this._setAutoResize()}this.obj.style.width=summ+"px";this.hdr.style.width=summ+"px";if(this.ftr){this.ftr.style.width=summ+"px"}this.chngCellWidth();return summ};this.setSizes=function(){if((!this.hdr.rows[0])){return }window.clearTimeout(this._sizeTime);if(!this.entBox.offsetWidth&&(!this.globalBox||!this.globalBox.offsetWidth)){this._sizeTime=window.setTimeout(function(){self.setSizes()},250);return }var quirks=this.quirks=(_isIE&&document.compatMode=="BackCompat");var outerBorder=(this.entBox.offsetWidth-this.entBox.clientWidth)/2;if(this.globalBox){var splitOuterBorder=(this.globalBox.offsetWidth-this.globalBox.clientWidth)/2;if(this._delta_x&&!this._realfake){var ow=this.globalBox.clientWidth;this.globalBox.style.width=this._delta_x;this.entBox.style.width=Math.max(0,(this.globalBox.clientWidth+(quirks?splitOuterBorder*2:0))-this._fake.entBox.clientWidth)+"px";if(ow!=this.globalBox.clientWidth){this._fake._correctSplit(this._fake.entBox.clientWidth)}}if(this._delta_y&&!this._realfake){this.globalBox.style.height=this._delta_y;this.entBox.style.overflow=this._fake.entBox.style.overflow="hidden";this.entBox.style.height=this._fake.entBox.style.height=this.globalBox.clientHeight+(quirks?splitOuterBorder*2:0)+"px"}}else{if(this._delta_x){if(this.entBox.parentNode.tagName=="TD"){this.entBox.style.width="1px";this.entBox.style.width=parseInt(this._delta_x)*this.entBox.parentNode.clientWidth/100-outerBorder*2+"px"}else{this.entBox.style.width=this._delta_x}}if(this._delta_y){this.entBox.style.height=this._delta_y}}var isVScroll=this.parentGrid?false:(this.objBox.scrollHeight>this.objBox.offsetHeight);var scrfix=_isFF?18:18;var gridWidth=this.entBox.clientWidth-(this.skin_h_correction||0)*(quirks?0:1);var gridWidthActive=this.entBox.clientWidth-(this.skin_h_correction||0);var gridHeight=this.entBox.clientHeight;var summ=this.setColumnSizes(gridWidthActive-(isVScroll?scrfix:0));var isHScroll=this.parentGrid?false:((this.objBox.scrollWidth>this.objBox.offsetWidth)||(this.objBox.style.overflowX=="scroll"));var headerHeight=this.hdr.clientHeight;var footerHeight=this.ftr?this.ftr.clientHeight:0;var newWidth=gridWidth;var newHeight=gridHeight-headerHeight-footerHeight;if(this._awdth&&this._awdth[0]&&this._awdth[1]==99999){isHScroll=0}if(this._ahgr){if(this._ahgrMA){newHeight=this.entBox.parentNode.clientHeight-headerHeight-footerHeight}else{newHeight=this.obj.offsetHeight+(isHScroll?scrfix:0)}if(this._ahgrM){if(this._ahgrF){newHeight=Math.min(this._ahgrM,newHeight+headerHeight+footerHeight)-headerHeight-footerHeight}else{newHeight=Math.min(this._ahgrM,newHeight)}}if(isVScroll&&newHeight>=this.obj.scrollHeight+(isHScroll?scrfix:0)){isVScroll=false;this.setColumnSizes(gridWidthActive)}}if((this._awdth)&&(this._awdth[0])){if(this.cellWidthType=="%"){this.cellWidthType="px"}if(this._fake){summ+=this._fake.entBox.clientWidth}var newWidth=Math.min(Math.max(summ+(isVScroll?scrfix:0),this._awdth[2]),this._awdth[1]);if(this._fake){newWidth-=this._fake.entBox.clientWidth}}newHeight=Math.max(0,newHeight);this._ff_size_delta=(this._ff_size_delta==0.1)?0.2:0.1;if(!_isFF){this._ff_size_delta=0}this.entBox.style.width=newWidth+(quirks?2:0)*outerBorder+this._ff_size_delta+"px";this.entBox.style.height=newHeight+(quirks?2:0)*outerBorder+headerHeight+footerHeight+"px";this.objBox.style.height=newHeight+((quirks&&!isVScroll)?2:0)*outerBorder+"px";this.hdrBox.style.height=headerHeight+"px";if(newHeight!=gridHeight){this.doOnScroll(0,!this._srnd)}var ext=this["setSizes_"+this.skin_name];if(ext){ext.call(this)}this.setSortImgPos();if(headerHeight!=this.hdr.clientHeight&&this._ahgr){this.setSizes()}};this.setSizes_clear=function(){var y=this.hdr.offsetHeight;var x=this.entBox.offsetWidth;var y2=y+this.objBox.offsetHeight;this._topMb.style.top=(y||0)+"px";this._topMb.style.width=(x+20)+"px";this._botMb.style.top=(y2-3)+"px";this._botMb.style.width=(x+20)+"px"};this.chngCellWidth=function(){if((_isOpera)&&(this.ftr)){this.ftr.width=this.objBox.scrollWidth+"px"}var l=this._cCount;for(var i=0;i<l;i++){this.hdr.rows[0].cells[i].style.width=this.cellWidthPX[i]+"px";this.obj.rows[0].childNodes[i].style.width=this.cellWidthPX[i]+"px";if(this.ftr){this.ftr.rows[0].cells[i].style.width=this.cellWidthPX[i]+"px"}}};this.setDelimiter=function(delim){this.delim=delim};this.setInitWidthsP=function(wp){this.cellWidthType="%";this.initCellWidth=wp.split(this.delim.replace(/px/gi,""));if(!arguments[1]){this._setAutoResize()}};this._setAutoResize=function(){if(this._realfake){return }var el=window;var self=this;dhtmlxEvent(window,"resize",function(){window.clearTimeout(self._resize_timer);if(self._setAutoResize){self._resize_timer=window.setTimeout(function(){self.setSizes();if(self._fake){self._fake._correctSplit()}},100)}})};this.setInitWidths=function(wp){this.cellWidthType="px";this.initCellWidth=wp.split(this.delim);if(_isFF){for(var i=0;i<this.initCellWidth.length;i++){if(this.initCellWidth[i]!="*"){this.initCellWidth[i]=parseInt(this.initCellWidth[i])}}}};this.enableMultiline=function(state){this.multiLine=convertStringToBoolean(state)};this.enableMultiselect=function(state){this.selMultiRows=convertStringToBoolean(state)};this.setImagePath=function(path){this.imgURL=path};this.setImagesPath=this.setImagePath;this.setIconPath=function(path){this.iconURL=path};this.setIconsPath=this.setIconPath;this.changeCursorState=function(ev){var el=ev.target||ev.srcElement;if(el.tagName!="TD"){el=this.getFirstParentOfType(el,"TD")}if(!el){return }if((el.tagName=="TD")&&(this._drsclmn)&&(!this._drsclmn[el._cellIndex])){return el.style.cursor="default"}var check=(ev.layerX||0)+(((!_isIE)&&(ev.target.tagName=="DIV"))?el.offsetLeft:0);if((el.offsetWidth-(ev.offsetX||(parseInt(this.getPosition(el,this.hdrBox))-check)*-1))<(_isOpera?20:10)){el.style.cursor="E-resize"}else{el.style.cursor="default"}if(_isOpera){this.hdrBox.scrollLeft=this.objBox.scrollLeft}};this.startColResize=function(ev){if(this.resized){this.stopColResize()}this.resized=null;var el=ev.target||ev.srcElement;if(el.tagName!="TD"){el=this.getFirstParentOfType(el,"TD")}var x=ev.clientX;var tabW=this.hdr.offsetWidth;var startW=parseInt(el.offsetWidth);if(el.tagName=="TD"&&el.style.cursor!="default"){if((this._drsclmn)&&(!this._drsclmn[el._cellIndex])){return }self._old_d_mm=document.body.onmousemove;self._old_d_mu=document.body.onmouseup;document.body.onmousemove=function(e){if(self){self.doColResize(e||window.event,el,startW,x,tabW)}};document.body.onmouseup=function(){if(self){self.stopColResize()}}}};this.stopColResize=function(){document.body.onmousemove=self._old_d_mm||"";document.body.onmouseup=self._old_d_mu||"";this.setSizes();this.doOnScroll(0,1);this.callEvent("onResizeEnd",[this])};this.doColResize=function(ev,el,startW,x,tabW){el.style.cursor="E-resize";this.resized=el;var fcolW=startW+(ev.clientX-x);var wtabW=tabW+(ev.clientX-x);if(!(this.callEvent("onResize",[el._cellIndex,fcolW,this]))){return }if(_isIE){this.objBox.scrollLeft=this.hdrBox.scrollLeft}if(el.colSpan>1){var a_sizes=new Array();for(var i=0;i<el.colSpan;i++){a_sizes[i]=Math.round(fcolW*this.hdr.rows[0].childNodes[el._cellIndexS+i].offsetWidth/el.offsetWidth)}for(var i=0;i<el.colSpan;i++){this._setColumnSizeR(el._cellIndexS+i*1,a_sizes[i])}}else{this._setColumnSizeR(el._cellIndex,fcolW)}this.doOnScroll(0,1);this.setSizes();if(this._fake&&this._awdth){this._fake._correctSplit()}};this._setColumnSizeR=function(ind,fcolW){if(fcolW>((this._drsclmW&&!this._notresize)?(this._drsclmW[ind]||10):10)){this.obj.rows[0].childNodes[ind].style.width=fcolW+"px";this.hdr.rows[0].childNodes[ind].style.width=fcolW+"px";if(this.ftr){this.ftr.rows[0].childNodes[ind].style.width=fcolW+"px"}if(this.cellWidthType=="px"){this.cellWidthPX[ind]=fcolW}else{var gridWidth=parseInt(this.entBox.offsetWidth);if(this.objBox.scrollHeight>this.objBox.offsetHeight){gridWidth-=17}var pcWidth=Math.round(fcolW/gridWidth*100);this.cellWidthPC[ind]=pcWidth}if(this.sortImg.style.display!="none"){this.setSortImgPos()}}};this.setSortImgState=function(state,ind,order,row){order=(order||"asc").toLowerCase();if(!convertStringToBoolean(state)){this.sortImg.style.display="none";this.fldSorted=null;return }if(order=="asc"){this.sortImg.src=this.imgURL+"sort_asc.gif"}else{this.sortImg.src=this.imgURL+"sort_desc.gif"}this.sortImg.style.display="";this.fldSorted=this.hdr.rows[0].childNodes[ind];var r=this.hdr.rows[row||1];if(!r){return }for(var i=0;i<r.childNodes.length;i++){if(r.childNodes[i]._cellIndexS==ind){this.r_fldSorted=r.childNodes[i];return this.setSortImgPos()}}return this.setSortImgState(state,ind,order,(row||1)+1)};this.setSortImgPos=function(ind,mode,hRowInd,el){if(this._hrrar&&this._hrrar[this.r_fldSorted?this.r_fldSorted._cellIndex:ind]){return }if(!el){if(!ind){var el=this.r_fldSorted}else{var el=this.hdr.rows[hRowInd||0].cells[ind]}}if(el!=null){var pos=this.getPosition(el,this.hdrBox);var wdth=el.offsetWidth;this.sortImg.style.left=Number(pos[0]+wdth-13)+"px";this.sortImg.defLeft=parseInt(this.sortImg.style.left);this.sortImg.style.top=Number(pos[1]+5)+"px";if((!this.useImagesInHeader)&&(!mode)){this.sortImg.style.display="inline"}this.sortImg.style.left=this.sortImg.defLeft+"px"}};this.setActive=function(fl){if(arguments.length==0){var fl=true}if(fl==true){if(globalActiveDHTMLGridObject&&(globalActiveDHTMLGridObject!=this)){globalActiveDHTMLGridObject.editStop()}globalActiveDHTMLGridObject=this;this.isActive=true}else{this.isActive=false}};this._doClick=function(ev){var selMethod=0;var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if(!el){return }var fl=true;if(this.markedCells){var markMethod=0;if(ev.shiftKey||ev.metaKey){markMethod=1}if(ev.ctrlKey){markMethod=2}this.doMark(el,markMethod);return true}if(this.selMultiRows!=false){if(ev.shiftKey&&this.row!=null){selMethod=1}if(ev.ctrlKey||ev.metaKey){selMethod=2}}this.doClick(el,fl,selMethod)};this._doContClick=function(ev){var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if((!el)||(typeof (el.parentNode.idd)=="undefined")){return true}if(ev.button==2||(_isMacOS&&ev.ctrlKey)){if(!this.callEvent("onRightClick",[el.parentNode.idd,el._cellIndex,ev])){var z=function(e){(e||event).cancelBubble=true;return false};(ev.srcElement||ev.target).oncontextmenu=z;return z(ev)}if(this._ctmndx){if(!(this.callEvent("onBeforeContextMenu",[el.parentNode.idd,el._cellIndex,this]))){return true}if(_isIE){ev.srcElement.oncontextmenu=function(){event.cancelBubble=true;return false}}if(this._ctmndx.showContextMenu){var dEl0=window.document.documentElement;var dEl1=window.document.body;var corrector=new Array((dEl0.scrollLeft||dEl1.scrollLeft),(dEl0.scrollTop||dEl1.scrollTop));if(_isIE){var x=ev.clientX+corrector[0];var y=ev.clientY+corrector[1]}else{var x=ev.pageX;var y=ev.pageY}this._ctmndx.showContextMenu(x-1,y-1);this.contextID=this._ctmndx.contextMenuZoneId=el.parentNode.idd+"_"+el._cellIndex;this._ctmndx._skip_hide=true}else{el.contextMenuId=el.parentNode.idd+"_"+el._cellIndex;el.contextMenu=this._ctmndx;el.a=this._ctmndx._contextStart;el.a(el,ev);el.a=null}ev.cancelBubble=true;return false}}else{if(this._ctmndx){if(this._ctmndx.hideContextMenu){this._ctmndx.hideContextMenu()}else{this._ctmndx._contextEnd()}}}return true};this.doClick=function(el,fl,selMethod,show){if(!this.selMultiRows){selMethod=0}var psid=this.row?this.row.idd:0;this.setActive(true);if(!selMethod){selMethod=0}if(this.cell!=null){this.cell.className=this.cell.className.replace(/cellselected/g,"")}if(el.tagName=="TD"){if(this.checkEvent("onSelectStateChanged")){var initial=this.getSelectedId()}var prow=this.row;if(selMethod==1){var elRowIndex=this.rowsCol._dhx_find(el.parentNode);var lcRowIndex=this.rowsCol._dhx_find(this.lastClicked);if(elRowIndex>lcRowIndex){var strt=lcRowIndex;var end=elRowIndex}else{var strt=elRowIndex;var end=lcRowIndex}for(var i=0;i<this.rowsCol.length;i++){if((i>=strt&&i<=end)){if(this.rowsCol[i]&&(!this.rowsCol[i]._sRow)){if(this.rowsCol[i].className.indexOf("rowselected")==-1&&this.callEvent("onBeforeSelect",[this.rowsCol[i].idd,psid])){this.rowsCol[i].className+=" rowselected";this.selectedRows[this.selectedRows.length]=this.rowsCol[i]}}else{this.clearSelection();return this.doClick(el,fl,0,show)}}}}else{if(selMethod==2){if(el.parentNode.className.indexOf("rowselected")!=-1){el.parentNode.className=el.parentNode.className.replace(/rowselected/g,"");this.selectedRows._dhx_removeAt(this.selectedRows._dhx_find(el.parentNode));var skipRowSelection=true}}}this.editStop();if(typeof (el.parentNode.idd)=="undefined"){return true}if((!skipRowSelection)&&(!el.parentNode._sRow)){if(this.callEvent("onBeforeSelect",[el.parentNode.idd,psid])){if(selMethod==0){this.clearSelection()}this.cell=el;if((prow==el.parentNode)&&(this._chRRS)){fl=false}this.row=el.parentNode;this.row.className+=" rowselected";if(this.cell&&_isIE&&_isIE==8){var next=this.cell.nextSibling;var parent=this.cell.parentNode;parent.removeChild(this.cell);parent.insertBefore(this.cell,next)}if(this.selectedRows._dhx_find(this.row)==-1){this.selectedRows[this.selectedRows.length]=this.row}}else{fl=false}}if(this.cell&&this.cell.parentNode.className.indexOf("rowselected")!=-1){this.cell.className=this.cell.className.replace(/cellselected/g,"")+" cellselected"}if(selMethod!=1){if(!this.row){return }}this.lastClicked=el.parentNode;var rid=this.row.idd;var cid=this.cell;if(fl&&typeof (rid)!="undefined"&&cid&&!skipRowSelection){self.onRowSelectTime=setTimeout(function(){self.callEvent("onRowSelect",[rid,cid._cellIndex])},100)}if(this.checkEvent("onSelectStateChanged")){var afinal=this.getSelectedId();if(initial!=afinal){this.callEvent("onSelectStateChanged",[afinal,initial])}}}this.isActive=true;if(show!==false&&this.cell&&this.cell.parentNode.idd){this.moveToVisible(this.cell)}};this.selectAll=function(){this.clearSelection();var coll=this.rowsBuffer;if(this.pagingOn){coll=this.rowsCol}for(var i=0;i<coll.length;i++){this.render_row(i).className+=" rowselected"}this.selectedRows=dhtmlxArray([].concat(coll));if(this.selectedRows.length){this.row=this.selectedRows[0];this.cell=this.row.cells[0]}if((this._fake)&&(!this._realfake)){this._fake.selectAll()}};this.selectCell=function(r,cInd,fl,preserve,edit,show){if(!fl){fl=false}if(typeof (r)!="object"){r=this.render_row(r)}if(!r||r==-1){return null}if(r._childIndexes){var c=r.childNodes[r._childIndexes[cInd]]}else{var c=r.childNodes[cInd]}if(!c){c=r.childNodes[0]}if(preserve){this.doClick(c,fl,3,show)}else{this.doClick(c,fl,0,show)}if(edit){this.editCell()}};this.moveToVisible=function(cell_obj,onlyVScroll){if(this.pagingOn){var newPage=Math.floor(this.getRowIndex(cell_obj.parentNode.idd)/this.rowsBufferOutSize)+1;if(newPage!=this.currentPage){this.changePage(newPage)}}if(!cell_obj.offsetHeight&&this._srnd){var mask=this._realfake?this._fake.rowsAr[cell_obj.parentNode.idd]:cell_obj.parentNode;var h=this.rowsBuffer._dhx_find(mask)*this._srdh;return this.objBox.scrollTop=h}try{var distance=cell_obj.offsetLeft+cell_obj.offsetWidth+20;var scrollLeft=0;if(distance>(this.objBox.offsetWidth+this.objBox.scrollLeft)){if(cell_obj.offsetLeft>this.objBox.scrollLeft){scrollLeft=cell_obj.offsetLeft-5}}else{if(cell_obj.offsetLeft<this.objBox.scrollLeft){distance-=cell_obj.offsetWidth*2/3;if(distance<this.objBox.scrollLeft){scrollLeft=cell_obj.offsetLeft-5}}}if((scrollLeft)&&(!onlyVScroll)){this.objBox.scrollLeft=scrollLeft}var distance=cell_obj.offsetTop+cell_obj.offsetHeight+20;if(distance>(this.objBox.offsetHeight+this.objBox.scrollTop)){var scrollTop=distance-this.objBox.offsetHeight}else{if(cell_obj.offsetTop<this.objBox.scrollTop){var scrollTop=cell_obj.offsetTop-5}}if(scrollTop){this.objBox.scrollTop=scrollTop}}catch(er){}};this.editCell=function(){if(this.editor&&this.cell==this.editor.cell){return }this.editStop();if((this.isEditable!=true)||(!this.cell)){return false}var c=this.cell;if(c.parentNode._locked){return false}this.editor=this.cells4(c);if(this.editor!=null){if(this.editor.isDisabled()){this.editor=null;return false}if(this.callEvent("onEditCell",[0,this.row.idd,this.cell._cellIndex])!=false&&this.editor.edit){this._Opera_stop=(new Date).valueOf();c.className+=" editable";this.editor.edit();this.callEvent("onEditCell",[1,this.row.idd,this.cell._cellIndex])}else{this.editor=null}}};this.editStop=function(mode){if(_isOpera){if(this._Opera_stop){if((this._Opera_stop*1+50)>(new Date).valueOf()){return }this._Opera_stop=null}}if(this.editor&&this.editor!=null){this.editor.cell.className=this.editor.cell.className.replace("editable","");if(mode){var t=this.editor.val;this.editor.detach();this.editor.setValue(t);this.editor=null;return }if(this.editor.detach()){this.cell.wasChanged=true}var g=this.editor;this.editor=null;var z=this.callEvent("onEditCell",[2,this.row.idd,this.cell._cellIndex,g.getValue(),g.val]);if((typeof (z)=="string")||(typeof (z)=="number")){g[g.setImage?"setLabel":"setValue"](z)}else{if(!z){g[g.setImage?"setLabel":"setValue"](g.val)}}}};this._nextRowCell=function(row,dir,pos){row=this._nextRow((this._groups?this.rowsCol:this.rowsBuffer)._dhx_find(row),dir);if(!row){return null}return row.childNodes[row._childIndexes?row._childIndexes[pos]:pos]};this._getNextCell=function(acell,dir,i){acell=acell||this.cell;var arow=acell.parentNode;if(this._tabOrder){i=this._tabOrder[acell._cellIndex];if(typeof i!="undefined"){if(i<0){acell=this._nextRowCell(arow,dir,Math.abs(i)-1)}else{acell=arow.childNodes[i]}}}else{var i=acell._cellIndex+dir;if(i>=0&&i<this._cCount){if(arow._childIndexes){i=arow._childIndexes[acell._cellIndex]+dir}acell=arow.childNodes[i]}else{acell=this._nextRowCell(arow,dir,(dir==1?0:(this._cCount-1)))}}if(!acell){if((dir==1)&&this.tabEnd){this.tabEnd.focus();this.tabEnd.focus();this.setActive(false)}if((dir==-1)&&this.tabStart){this.tabStart.focus();this.tabStart.focus();this.setActive(false)}return null}if(acell.style.display!="none"&&(!this.smartTabOrder||!this.cells(acell.parentNode.idd,acell._cellIndex).isDisabled())){return acell}return this._getNextCell(acell,dir)};this._nextRow=function(ind,dir){var r=this.render_row(ind+dir);if(!r||r==-1){return null}if(r&&r.style.display=="none"){return this._nextRow(ind+dir,dir)}return r};this.scrollPage=function(dir){if(!this.rowsBuffer.length){return }var master=this._realfake?this._fake:this;var new_ind=Math.floor((master._r_select||this.getRowIndex(this.row.idd)||0)+(dir)*this.objBox.offsetHeight/(this._srdh||20));if(new_ind<0){new_ind=0}if(new_ind>=this.rowsBuffer.length){new_ind=this.rowsBuffer.length-1}if(this._srnd&&!this.rowsBuffer[new_ind]){this.objBox.scrollTop+=Math.floor((dir)*this.objBox.offsetHeight/(this._srdh||20))*(this._srdh||20);master._r_select=new_ind}else{this.selectCell(new_ind,this.cell._cellIndex,true,false,false,(this.multiLine||this._srnd));if(!this.multiLine&&!this._srnd&&!this._realfake){this.objBox.scrollTop=this.getRowById(this.getRowId(new_ind)).offsetTop}master._r_select=null}};this.doKey=function(ev){if(!ev){return true}if((ev.target||ev.srcElement).value!==window.undefined){var zx=(ev.target||ev.srcElement);if((!zx.parentNode)||(zx.parentNode.className.indexOf("editable")==-1)){return true}}if((globalActiveDHTMLGridObject)&&(this!=globalActiveDHTMLGridObject)){return globalActiveDHTMLGridObject.doKey(ev)}if(this.isActive==false){return true}if(this._htkebl){return true}if(!this.callEvent("onKeyPress",[ev.keyCode,ev.ctrlKey,ev.shiftKey,ev])){return false}var code="k"+ev.keyCode+"_"+(ev.ctrlKey?1:0)+"_"+(ev.shiftKey?1:0);if(this.cell){if(this._key_events[code]){if(false===this._key_events[code].call(this)){return true}if(ev.preventDefault){ev.preventDefault()}ev.cancelBubble=true;return false}if(this._key_events.k_other){this._key_events.k_other.call(this,ev)}}return true};this.selectRow=function(r,fl,preserve,show){if(typeof (r)!="object"){r=this.render_row(r)}this.selectCell(r,0,fl,preserve,false,show)};this.wasDblClicked=function(ev){var el=this.getFirstParentOfType(_isIE?ev.srcElement:ev.target,"TD");if(el){var rowId=el.parentNode.idd;return this.callEvent("onRowDblClicked",[rowId,el._cellIndex])}};this._onHeaderClick=function(e,el){var that=this.grid;el=el||that.getFirstParentOfType(_isIE?event.srcElement:e.target,"TD");if(this.grid.resized==null){if(!(this.grid.callEvent("onHeaderClick",[el._cellIndexS,(e||window.event)]))){return false}that.sortField(el._cellIndexS,false,el)}};this.deleteSelectedRows=function(){var num=this.selectedRows.length;if(num==0){return }var tmpAr=this.selectedRows;this.selectedRows=dhtmlxArray();for(var i=num-1;i>=0;i--){var node=tmpAr[i];if(!this.deleteRow(node.idd,node)){this.selectedRows[this.selectedRows.length]=node}else{if(node==this.row){var ind=i}}}if(ind){try{if(ind+1>this.rowsCol.length){ind--}this.selectCell(ind,0,true)}catch(er){this.row=null;this.cell=null}}};this.getSelectedRowId=function(){var selAr=new Array(0);var uni={};for(var i=0;i<this.selectedRows.length;i++){var id=this.selectedRows[i].idd;if(uni[id]){continue}selAr[selAr.length]=id;uni[id]=true}if(selAr.length==0){return null}else{return selAr.join(this.delim)}};this.getSelectedCellIndex=function(){if(this.cell!=null){return this.cell._cellIndex}else{return -1}};this.getColWidth=function(ind){return parseInt(this.cellWidthPX[ind])+((_isFF)?2:0)};this.setColWidth=function(ind,value){if(this._hrrar[ind]){return }if(this.cellWidthType=="px"){this.cellWidthPX[ind]=parseInt(value)-+((_isFF)?2:0)}else{this.cellWidthPC[ind]=parseInt(value)}this.setSizes()};this.getRowIndex=function(row_id){for(var i=0;i<this.rowsBuffer.length;i++){if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==row_id){return i}}return -1};this.getRowId=function(ind){return this.rowsBuffer[ind]?this.rowsBuffer[ind].idd:this.undefined};this.setRowId=function(ind,row_id){this.changeRowId(this.getRowId(ind),row_id)};this.changeRowId=function(oldRowId,newRowId){if(oldRowId==newRowId){return }var row=this.rowsAr[oldRowId];row.idd=newRowId;if(this.UserData[oldRowId]){this.UserData[newRowId]=this.UserData[oldRowId];this.UserData[oldRowId]=null}if(this._h2&&this._h2.get[oldRowId]){this._h2.get[newRowId]=this._h2.get[oldRowId];this._h2.get[newRowId].id=newRowId;delete this._h2.get[oldRowId]}this.rowsAr[oldRowId]=null;this.rowsAr[newRowId]=row;for(var i=0;i<row.childNodes.length;i++){if(row.childNodes[i]._code){row.childNodes[i]._code=this._compileSCL(row.childNodes[i]._val,row.childNodes[i])}}if(this._mat_links&&this._mat_links[oldRowId]){var a=this._mat_links[oldRowId];delete this._mat_links[oldRowId];for(var c in a){for(var i=0;i<a[c].length;i++){this._compileSCL(a[c][i].original,a[c][i])}}}this.callEvent("onRowIdChange",[oldRowId,newRowId])};this.setColumnIds=function(ids){this.columnIds=ids.split(this.delim)};this.setColumnId=function(ind,id){this.columnIds[ind]=id};this.getColIndexById=function(id){for(var i=0;i<this.columnIds.length;i++){if(this.columnIds[i]==id){return i}}};this.getColumnId=function(cin){return this.columnIds[cin]};this.getColumnLabel=function(cin,ind,hdr){var z=(hdr||this.hdr).rows[(ind||0)+1];for(var i=0;i<z.cells.length;i++){if(z.cells[i]._cellIndexS==cin){return(_isIE?z.cells[i].innerText:z.cells[i].textContent)}}return""};this.getFooterLabel=function(cin,ind){return this.getColumnLabel(cin,ind,this.ftr)};this.setRowTextBold=function(row_id){var r=this.getRowById(row_id);if(r){r.style.fontWeight="bold"}};this.setRowTextStyle=function(row_id,styleString){var r=this.getRowById(row_id);if(!r){return }for(var i=0;i<r.childNodes.length;i++){var pfix=r.childNodes[i]._attrs.style||"";if((this._hrrar)&&(this._hrrar[i])){pfix="display:none;"}if(_isIE){r.childNodes[i].style.cssText=pfix+"width:"+r.childNodes[i].style.width+";"+styleString}else{r.childNodes[i].style.cssText=pfix+"width:"+r.childNodes[i].style.width+";"+styleString}}};this.setRowColor=function(row_id,color){var r=this.getRowById(row_id);for(var i=0;i<r.childNodes.length;i++){r.childNodes[i].bgColor=color}};this.setCellTextStyle=function(row_id,ind,styleString){var r=this.getRowById(row_id);if(!r){return }var cell=r.childNodes[r._childIndexes?r._childIndexes[ind]:ind];if(!cell){return }var pfix="";if((this._hrrar)&&(this._hrrar[ind])){pfix="display:none;"}if(_isIE){cell.style.cssText=pfix+"width:"+cell.style.width+";"+styleString}else{cell.style.cssText=pfix+"width:"+cell.style.width+";"+styleString}};this.setRowTextNormal=function(row_id){var r=this.getRowById(row_id);if(r){r.style.fontWeight="normal"}};this.doesRowExist=function(row_id){if(this.getRowById(row_id)!=null){return true}else{return false}};this.getColumnsNum=function(){return this._cCount};this.moveRowUp=function(row_id){var r=this.getRowById(row_id);if(this.isTreeGrid()){return this.moveRowUDTG(row_id,-1)}var rInd=this.rowsCol._dhx_find(r);if((r.previousSibling)&&(rInd!=0)){r.parentNode.insertBefore(r,r.previousSibling);this.rowsCol._dhx_swapItems(rInd,rInd-1);this.setSizes();var bInd=this.rowsBuffer._dhx_find(r);this.rowsBuffer._dhx_swapItems(bInd,bInd-1);if(this._cssEven){this._fixAlterCss(rInd-1)}}};this.moveRowDown=function(row_id){var r=this.getRowById(row_id);if(this.isTreeGrid()){return this.moveRowUDTG(row_id,1)}var rInd=this.rowsCol._dhx_find(r);if(r.nextSibling){this.rowsCol._dhx_swapItems(rInd,rInd+1);if(r.nextSibling.nextSibling){r.parentNode.insertBefore(r,r.nextSibling.nextSibling)}else{r.parentNode.appendChild(r)}this.setSizes();var bInd=this.rowsBuffer._dhx_find(r);this.rowsBuffer._dhx_swapItems(bInd,bInd+1);if(this._cssEven){this._fixAlterCss(rInd)}}};this.getCombo=function(col_ind){if(!this.combos[col_ind]){this.combos[col_ind]=new dhtmlXGridComboObject()}return this.combos[col_ind]};this.setUserData=function(row_id,name,value){if(!row_id){row_id="gridglobaluserdata"}if(!this.UserData[row_id]){this.UserData[row_id]=new Hashtable()}this.UserData[row_id].put(name,value)};this.getUserData=function(row_id,name){if(!row_id){row_id="gridglobaluserdata"}this.getRowById(row_id);var z=this.UserData[row_id];return(z?z.get(name):"")};this.setEditable=function(fl){this.isEditable=convertStringToBoolean(fl)};this.selectRowById=function(row_id,multiFL,show,call){if(!call){call=false}this.selectCell(this.getRowById(row_id),0,call,multiFL,false,show)};this.clearSelection=function(){this.editStop();for(var i=0;i<this.selectedRows.length;i++){var r=this.rowsAr[this.selectedRows[i].idd];if(r){r.className=r.className.replace(/rowselected/g,"")}}this.selectedRows=dhtmlxArray();this.row=null;if(this.cell!=null){this.cell.className=this.cell.className.replace(/cellselected/g,"");this.cell=null}};this.copyRowContent=function(from_row_id,to_row_id){var frRow=this.getRowById(from_row_id);if(!this.isTreeGrid()){for(var i=0;i<frRow.cells.length;i++){this.cells(to_row_id,i).setValue(this.cells(from_row_id,i).getValue())}}else{this._copyTreeGridRowContent(frRow,from_row_id,to_row_id)}if(!_isIE){this.getRowById(from_row_id).cells[0].height=frRow.cells[0].offsetHeight}};this.setFooterLabel=function(c,label,ind){return this.setColumnLabel(c,label,ind,this.ftr)};this.setColumnLabel=function(c,label,ind,hdr){var z=(hdr||this.hdr).rows[ind||1];var col=(z._childIndexes?z._childIndexes[c]:c);if(!z.cells[col]){return }if(!this.useImagesInHeader){var hdrHTML="<div class='hdrcell'>";if(label.indexOf("img:[")!=-1){var imUrl=label.replace(/.*\[([^>]+)\].*/,"$1");label=label.substr(label.indexOf("]")+1,label.length);hdrHTML+="<img width='18px' height='18px' align='absmiddle' src='"+imUrl+"' hspace='2'>"}hdrHTML+=label;hdrHTML+="</div>";z.cells[col].innerHTML=hdrHTML;if(this._hstyles[col]){z.cells[col].style.cssText=this._hstyles[col]}}else{z.cells[col].style.textAlign="left";z.cells[col].innerHTML="<img src='"+this.imgURL+""+label+"' onerror='this.src = \""+this.imgURL+"imageloaderror.gif\"'>";var a=new Image();a.src=this.imgURL+""+label.replace(/(\.[a-z]+)/,".des$1");this.preloadImagesAr[this.preloadImagesAr.length]=a;var b=new Image();b.src=this.imgURL+""+label.replace(/(\.[a-z]+)/,".asc$1");this.preloadImagesAr[this.preloadImagesAr.length]=b}if((label||"").indexOf("#")!=-1){var t=label.match(/(^|{)#([^}]+)(}|$)/);if(t){var tn="_in_header_"+t[2];if(this[tn]){this[tn]((this.forceDivInHeader?z.cells[col].firstChild:z.cells[col]),col,label.split(t[0]))}}}};this.clearAll=function(header){if(!this.obj.rows[0]){return }if(this._h2){this._h2=new dhtmlxHierarchy();if(this._fake){if(this._realfake){this._h2=this._fake._h2}else{this._fake._h2=this._h2}}}this.limit=this._limitC=0;this.editStop(true);if(this._dLoadTimer){window.clearTimeout(this._dLoadTimer)}if(this._dload){this.objBox.scrollTop=0;this.limit=this._limitC||0;this._initDrF=true}var len=this.rowsCol.length;len=this.obj.rows.length;for(var i=len-1;i>0;i--){var t_r=this.obj.rows[i];t_r.parentNode.removeChild(t_r)}if(header){this._master_row=null;this.obj.rows[0].parentNode.removeChild(this.obj.rows[0]);for(var i=this.hdr.rows.length-1;i>=0;i--){var t_r=this.hdr.rows[i];t_r.parentNode.removeChild(t_r)}if(this.ftr){this.ftr.parentNode.removeChild(this.ftr);this.ftr=null}this._aHead=this.ftr=this.cellWidth=this._aFoot=null;this.cellType=dhtmlxArray();this._hrrar=[];this.columnIds=[];this.combos=[]}this.row=null;this.cell=null;this.rowsCol=dhtmlxArray();this.rowsAr=[];this._RaSeCol=[];this.rowsBuffer=dhtmlxArray();this.UserData=[];this.selectedRows=dhtmlxArray();if(this.pagingOn||this._srnd){this.xmlFileUrl=""}if(this.pagingOn){this.changePage(1)}if(this._contextCallTimer){window.clearTimeout(this._contextCallTimer)}if(this._sst){this.enableStableSorting(true)}this._fillers=this.undefined;this.setSortImgState(false);this.setSizes();this.callEvent("onClearAll",[])};this.sortField=function(ind,repeatFl,r_el){if(this.getRowsNum()==0){return false}var el=this.hdr.rows[0].cells[ind];if(!el){return }if(el.tagName=="TH"&&(this.fldSort.length-1)>=el._cellIndex&&this.fldSort[el._cellIndex]!="na"){var data=this.getSortingState();var sortType=(data[0]==ind&&data[1]=="asc")?"des":"asc";if(!this.callEvent("onBeforeSorting",[ind,this.fldSort[ind],sortType])){return }this.sortImg.src=this.imgURL+"sort_"+(sortType=="asc"?"asc":"desc")+".gif";if(this.useImagesInHeader){var cel=this.hdr.rows[1].cells[el._cellIndex].firstChild;if(this.fldSorted!=null){var celT=this.hdr.rows[1].cells[this.fldSorted._cellIndex].firstChild;celT.src=celT.src.replace(/(\.asc\.)|(\.des\.)/,".")}cel.src=cel.src.replace(/(\.[a-z]+)$/,"."+sortType+"$1")}this.sortRows(el._cellIndex,this.fldSort[el._cellIndex],sortType);this.fldSorted=el;this.r_fldSorted=r_el;var c=this.hdr.rows[1];var c=r_el.parentNode;var real_el=c._childIndexes?c._childIndexes[el._cellIndex]:el._cellIndex;this.setSortImgPos(false,false,false,r_el)}};this.setCustomSorting=function(func,col){if(!this._customSorts){this._customSorts=new Array()}this._customSorts[col]=(typeof (func)=="string")?eval(func):func;this.fldSort[col]="cus"};this.enableHeaderImages=function(fl){this.useImagesInHeader=fl};this.setHeader=function(hdrStr,splitSign,styles){if(typeof (hdrStr)!="object"){var arLab=this._eSplit(hdrStr)}else{arLab=[].concat(hdrStr)}var arWdth=new Array(0);var arTyp=new dhtmlxArray(0);var arAlg=new Array(0);var arVAlg=new Array(0);var arSrt=new Array(0);for(var i=0;i<arLab.length;i++){arWdth[arWdth.length]=Math.round(100/arLab.length);arTyp[arTyp.length]="ed";arAlg[arAlg.length]="left";arVAlg[arVAlg.length]="middle";arSrt[arSrt.length]="na"}this.splitSign=splitSign||"#cspan";this.hdrLabels=arLab;this.cellWidth=arWdth;if(!this.initCellWidth.length){this.setInitWidthsP(arWdth.join(this.delim),true)}this.cellType=arTyp;this.cellAlign=arAlg;this.cellVAlign=arVAlg;this.fldSort=arSrt;this._hstyles=styles||[]};this._eSplit=function(str){if(![].push){return str.split(this.delim)}var a="r"+(new Date()).valueOf();var z=this.delim.replace(/([\|\+\*\^])/g,"\\$1");return(str||"").replace(RegExp(z,"g"),a).replace(RegExp("\\\\"+a,"g"),this.delim).split(a)};this.getColType=function(cInd){return this.cellType[cInd]};this.getColTypeById=function(cID){return this.cellType[this.getColIndexById(cID)]};this.setColTypes=function(typeStr){this.cellType=dhtmlxArray(typeStr.split(this.delim));this._strangeParams=new Array();for(var i=0;i<this.cellType.length;i++){if((this.cellType[i].indexOf("[")!=-1)){var z=this.cellType[i].split(/[\[\]]+/g);this.cellType[i]=z[0];this.defVal[i]=z[1];if(z[1].indexOf("=")==0){this.cellType[i]="math";this._strangeParams[i]=z[0]}}if(!window["eXcell_"+this.cellType[i]]){dhtmlxError.throwError("Configuration","Incorrect cell type: "+this.cellType[i],[this,this.cellType[i]])}}};this.setColSorting=function(sortStr){this.fldSort=sortStr.split(this.delim);for(var i=0;i<this.fldSort.length;i++){if(((this.fldSort[i]).length>4)&&(typeof (window[this.fldSort[i]])=="function")){if(!this._customSorts){this._customSorts=new Array()}this._customSorts[i]=window[this.fldSort[i]];this.fldSort[i]="cus"}}};this.setColAlign=function(alStr){this.cellAlign=alStr.split(this.delim);for(var i=0;i<this.cellAlign.length;i++){this.cellAlign[i]=this.cellAlign[i]._dhx_trim()}};this.setColVAlign=function(valStr){this.cellVAlign=valStr.split(this.delim)};this.setNoHeader=function(fl){this.noHeader=convertStringToBoolean(fl)};this.showRow=function(rowID){this.getRowById(rowID);if(this._h2){this.openItem(this._h2.get[rowID].parent.id)}var c=this.getRowById(rowID).childNodes[0];while(c&&c.style.display=="none"){c=c.nextSibling}if(c){this.moveToVisible(c,true)}};this.setStyle=function(ss_header,ss_grid,ss_selCell,ss_selRow){this.ssModifier=[ss_header,ss_grid,ss_selCell,ss_selCell,ss_selRow];var prefs=["#"+this.entBox.id+" table.hdr td","#"+this.entBox.id+" table.obj td","#"+this.entBox.id+" table.obj tr.rowselected td.cellselected","#"+this.entBox.id+" table.obj td.cellselected","#"+this.entBox.id+" table.obj tr.rowselected td"];for(var i=0;i<prefs.length;i++){if(this.ssModifier[i]){if(_isIE){document.styleSheets[0].addRule(prefs[i],this.ssModifier[i])}else{document.styleSheets[0].insertRule(prefs[i]+" { "+this.ssModifier[i]+" } ",0)}}}};this.setColumnColor=function(clr){this.columnColor=clr.split(this.delim)};this.enableAlterCss=function(cssE,cssU,perLevel,levelUnique){if(cssE||cssU){this.attachEvent("onGridReconstructed",function(){this._fixAlterCss();if(this._fake){this._fake._fixAlterCss()}})}this._cssSP=perLevel;this._cssSU=levelUnique;this._cssEven=cssE;this._cssUnEven=cssU};this._fixAlterCss=function(ind){if(this._h2&&(this._cssSP||this._cssSU)){return this._fixAlterCssTGR(ind)}if(!this._cssEven&&!this._cssUnEven){return }ind=ind||0;var j=ind;for(var i=ind;i<this.rowsCol.length;i++){if(!this.rowsCol[i]){continue}if(this.rowsCol[i].style.display!="none"){if(this.rowsCol[i].className.indexOf("rowselected")!=-1){if(j%2==1){this.rowsCol[i].className=this._cssUnEven+" rowselected "+(this.rowsCol[i]._css||"")}else{this.rowsCol[i].className=this._cssEven+" rowselected "+(this.rowsCol[i]._css||"")}}else{if(j%2==1){this.rowsCol[i].className=this._cssUnEven+" "+(this.rowsCol[i]._css||"")}else{this.rowsCol[i].className=this._cssEven+" "+(this.rowsCol[i]._css||"")}}j++}}};this.clearChangedState=function(){for(var i=0;i<this.rowsCol.length;i++){var row=this.rowsCol[i];var cols=row.childNodes.length;for(var j=0;j<cols;j++){row.childNodes[j].wasChanged=false}}};this.getChangedRows=function(and_added){var res=new Array();this.forEachRow(function(id){var row=this.rowsAr[id];if(row.tagName!="TR"){return }var cols=row.childNodes.length;if(and_added&&row._added){res[res.length]=row.idd}else{for(var j=0;j<cols;j++){if(row.childNodes[j].wasChanged){res[res.length]=row.idd;break}}}});return res.join(this.delim)};this._sUDa=false;this._sAll=false;this.setSerializationLevel=function(userData,fullXML,config,changedAttr,onlyChanged,asCDATA){this._sUDa=userData;this._sAll=fullXML;this._sConfig=config;this._chAttr=changedAttr;this._onlChAttr=onlyChanged;this._asCDATA=asCDATA};this.setSerializableColumns=function(list){if(!list){this._srClmn=null;return }this._srClmn=(list||"").split(",");for(var i=0;i<this._srClmn.length;i++){this._srClmn[i]=convertStringToBoolean(this._srClmn[i])}};this._serialise=function(rCol,inner,closed){this.editStop();var out=[];var close="</"+this.xml.s_row+">";if(this.isTreeGrid()){this._h2.forEachChildF(0,function(el){var temp=this._serializeRow(this.render_row_tree(-1,el.id));out.push(temp);if(temp){return true}else{return false}},this,function(){out.push(close)})}else{for(var i=0;i<this.rowsBuffer.length;i++){if(this.rowsBuffer[i]){var temp=this._serializeRow(this.render_row(i));out.push(temp);if(temp){out.push(close)}}}}return[out.join("")]};this._serializeRow=function(r,i){var out=[];var ra=this.xml.row_attrs;var ca=this.xml.cell_attrs;out.push("<"+this.xml.s_row);out.push(" id='"+r.idd+"'");if((this._sAll)&&this.selectedRows._dhx_find(r)!=-1){out.push(" selected='1'")}if(this._h2&&this._h2.get[r.idd].state=="minus"){out.push(" open='1'")}if(ra.length){for(var i=0;i<ra.length;i++){out.push(" "+ra[i]+"='"+r._attrs[ra[i]]+"'")}}out.push(">");if(this._sUDa&&this.UserData[r.idd]){keysAr=this.UserData[r.idd].getKeys();for(var ii=0;ii<keysAr.length;ii++){out.push("<userdata name='"+keysAr[ii]+"'>"+(this._asCDATA?"<![CDATA[":"")+this.UserData[r.idd].get(keysAr[ii])+(this._asCDATA?"]]>":"")+"</userdata>")}}var changeFl=false;for(var jj=0;jj<this._cCount;jj++){if((!this._srClmn)||(this._srClmn[jj])){var zx=this.cells3(r,jj);out.push("<cell");if(ca.length){for(var i=0;i<ca.length;i++){out.push(" "+ca[i]+"='"+zx.cell._attrs[ca[i]]+"'")}}zxVal=zx[this._agetm]();if(this._asCDATA){zxVal="<![CDATA["+zxVal+"]]>"}if((this._ecspn)&&(zx.cell.colSpan)&&zx.cell.colSpan>1){out.push(' colspan="'+zx.cell.colSpan+'" ')}if(this._chAttr){if(zx.wasChanged()){out.push(' changed="1"');changeFl=true}}else{if((this._onlChAttr)&&(zx.wasChanged())){changeFl=true}}if(this._sAll&&this.cellType[jj]=="tree"){out.push((this._h2?(" image='"+this._h2.get[r.idd].image+"'"):"")+">"+zxVal+"</cell>")}else{out.push(">"+zxVal+"</cell>")}if((this._ecspn)&&(zx.cell.colSpan)){for(var u=0;u<zx.cell.colSpan-1;u++){out.push("<cell/>");jj++}}}}if((this._onlChAttr)&&(!changeFl)&&(!r._added)){return""}return out.join("")};this._serialiseConfig=function(){var out="<head>";for(var i=0;i<this.hdr.rows[0].cells.length;i++){if(this._srClmn&&!this._srClmn[i]){continue}var sort=this.fldSort[i];if(sort=="cus"){sort=this._customSorts[i].toString();sort=sort.replace(/function[\ ]*/,"").replace(/\([^\f]*/,"")}out+="<column width='"+this.getColWidth(i)+"' align='"+this.cellAlign[i]+"' type='"+this.cellType[i]+"' sort='"+(sort||"na")+"' color='"+this.columnColor[i]+"'"+(this.columnIds[i]?(" id='"+this.columnIds[i]+"'"):"")+">";if(this._asCDATA){out+="<![CDATA["+this.getHeaderCol(i)+"]]>"}else{out+=this.getHeaderCol(i)}var z=this.getCombo(i);if(z){for(var j=0;j<z.keys.length;j++){out+="<option value='"+z.keys[j]+"'>"+z.values[j]+"</option>"}}out+="</column>"}return out+="</head>"};this.serialize=function(){var out='<?xml version="1.0"?><rows>';if(this._mathSerialization){this._agetm="getMathValue"}else{this._agetm="getValue"}if(this._sUDa&&this.UserData.gridglobaluserdata){var keysAr=this.UserData.gridglobaluserdata.getKeys();for(var i=0;i<keysAr.length;i++){out+="<userdata name='"+keysAr[i]+"'>"+this.UserData.gridglobaluserdata.get(keysAr[i])+"</userdata>"}}if(this._sConfig){out+=this._serialiseConfig()}out+=this._serialise();out+="</rows>";return out};this.getPosition=function(oNode,pNode){if(!pNode&&!_isChrome){var pos=getOffset(oNode);return[pos.left,pos.top]}pNode=pNode||document.body;var oCurrentNode=oNode;var iLeft=0;var iTop=0;while((oCurrentNode)&&(oCurrentNode!=pNode)){iLeft+=oCurrentNode.offsetLeft-oCurrentNode.scrollLeft;iTop+=oCurrentNode.offsetTop-oCurrentNode.scrollTop;oCurrentNode=oCurrentNode.offsetParent}if(pNode==document.body){if(_isIE){iTop+=document.body.offsetTop||document.documentElement.offsetTop;iLeft+=document.body.offsetLeft||document.documentElement.offsetLeft}else{if(!_isFF){iLeft+=document.body.offsetLeft;iTop+=document.body.offsetTop}}}return[iLeft,iTop]};this.getFirstParentOfType=function(obj,tag){while(obj&&obj.tagName!=tag&&obj.tagName!="BODY"){obj=obj.parentNode}return obj};this.objBox.onscroll=function(){this.grid._doOnScroll()};if((!_isOpera)||(_OperaRv>8.5)){this.hdr.onmousemove=function(e){this.grid.changeCursorState(e||window.event)};this.hdr.onmousedown=function(e){return this.grid.startColResize(e||window.event)}}this.obj.onmousemove=this._drawTooltip;this.obj.onclick=function(e){this.grid._doClick(e||window.event);if(this.grid._sclE){this.grid.editCell(e||window.event)}(e||event).cancelBubble=true};if(_isMacOS){this.entBox.oncontextmenu=function(e){e.cancelBubble=true;e.returnValue=false;return this.grid._doContClick(e||window.event)}}else{this.entBox.onmousedown=function(e){return this.grid._doContClick(e||window.event)};this.entBox.oncontextmenu=function(e){if(this.grid._ctmndx){(e||event).cancelBubble=true}return !this.grid._ctmndx}}this.obj.ondblclick=function(e){if(!this.grid.wasDblClicked(e||window.event)){return false}if(this.grid._dclE){var row=this.grid.getFirstParentOfType((_isIE?event.srcElement:e.target),"TR");if(row==this.grid.row){this.grid.editCell(e||window.event)}}(e||event).cancelBubble=true;if(_isOpera){return false}};this.hdr.onclick=this._onHeaderClick;this.sortImg.onclick=function(){self._onHeaderClick.apply({grid:self},[null,self.r_fldSorted])};this.hdr.ondblclick=this._onHeaderDblClick;if(!document.body._dhtmlxgrid_onkeydown){dhtmlxEvent(document,_isOpera?"keypress":"keydown",function(e){if(globalActiveDHTMLGridObject){return globalActiveDHTMLGridObject.doKey(e||window.event)}});document.body._dhtmlxgrid_onkeydown=true}dhtmlxEvent(document.body,"click",function(){if(self.editStop){self.editStop()}});this.entBox.onbeforeactivate=function(){this._still_active=null;this.grid.setActive();event.cancelBubble=true};this.entBox.onbeforedeactivate=function(){if(this.grid._still_active){this.grid._still_active=null}else{this.grid.isActive=false}event.cancelBubble=true};if(this.entBox.style.height.toString().indexOf("%")!=-1){this._delta_y=this.entBox.style.height}if(this.entBox.style.width.toString().indexOf("%")!=-1){this._delta_x=this.entBox.style.width}if(this._delta_x||this._delta_y){this._setAutoResize()}this.setColHidden=this.setColumnsVisibility;this.enableCollSpan=this.enableColSpan;this.setMultiselect=this.enableMultiselect;this.setMultiLine=this.enableMultiline;this.deleteSelectedItem=this.deleteSelectedRows;this.getSelectedId=this.getSelectedRowId;this.getHeaderCol=this.getColumnLabel;this.isItemExists=this.doesRowExist;this.getColumnCount=this.getColumnsNum;this.setSelectedRow=this.selectRowById;this.setHeaderCol=this.setColumnLabel;this.preventIECashing=this.preventIECaching;this.enableAutoHeigth=this.enableAutoHeight;this.getUID=this.uid;if(dhtmlx.image_path){this.setImagePath(dhtmlx.image_path)}if(dhtmlx.skin){this.setSkin(dhtmlx.skin)}return this}dhtmlXGridObject.prototype={getRowAttribute:function(B,A){return this.getRowById(B)._attrs[A]},setRowAttribute:function(C,A,B){this.getRowById(C)._attrs[A]=B},isTreeGrid:function(){return(this.cellType._dhx_find("tree")!=-1)},setRowHidden:function(F,C){var B=convertStringToBoolean(C);var E=this.getRowById(F);if(!E){return }if(E.expand===""){this.collapseKids(E)}if((C)&&(E.style.display!="none")){E.style.display="none";var D=this.selectedRows._dhx_find(E);if(D!=-1){E.className=E.className.replace("rowselected","");for(var A=0;A<E.childNodes.length;A++){E.childNodes[A].className=E.childNodes[A].className.replace(/cellselected/g,"")}this.selectedRows._dhx_removeAt(D)}this.callEvent("onGridReconstructed",[])}if((!C)&&(E.style.display=="none")){E.style.display="";this.callEvent("onGridReconstructed",[])}this.setSizes()},setColumnHidden:function(C,B){if(!this.hdr.rows.length){if(!this._ivizcol){this._ivizcol=[]}return this._ivizcol[C]=B}if((this.fldSorted)&&(this.fldSorted.cellIndex==C)&&(B)){this.sortImg.style.display="none"}var A=convertStringToBoolean(B);if(A){if(!this._hrrar){this._hrrar=new Array()}else{if(this._hrrar[C]){return }}this._hrrar[C]="display:none;";this._hideShowColumn(C,"none")}else{if((!this._hrrar)||(!this._hrrar[C])){return }this._hrrar[C]="";this._hideShowColumn(C,"")}if((this.fldSorted)&&(this.fldSorted.cellIndex==C)&&(!B)){this.sortImg.style.display="inline"}this.setSortImgPos();this.callEvent("onColumnHidden",[C,B])},isColumnHidden:function(A){if((this._hrrar)&&(this._hrrar[A])){return true}return false},setColumnsVisibility:function(B){if(B){this._ivizcol=B.split(this.delim)}if(this.hdr.rows.length&&this._ivizcol){for(var A=0;A<this._ivizcol.length;A++){this.setColumnHidden(A,this._ivizcol[A])}}},_fixHiddenRowsAll:function(H,C,A,B,F){F=F||"_cellIndex";var G=H.rows.length;for(var E=0;E<G;E++){var I=H.rows[E].childNodes;if(I.length!=this._cCount){for(var D=0;D<I.length;D++){if(I[D][F]==C){I[D].style[A]=B;break}}}else{I[C].style[A]=B}}},_hideShowColumn:function(E,D){var A=E;if((this.hdr.rows[1]._childIndexes)&&(this.hdr.rows[1]._childIndexes[E]!=E)){A=this.hdr.rows[1]._childIndexes[E]}if(D=="none"){this.hdr.rows[0].cells[E]._oldWidth=this.hdr.rows[0].cells[E].style.width||(this.initCellWidth[E]+"px");this.hdr.rows[0].cells[E]._oldWidthP=this.cellWidthPC[E];this.obj.rows[0].cells[E].style.width="0px";var B={rows:[this.obj.rows[0]]};this.forEachRow(function(F){if(this.rowsAr[F].tagName=="TR"){B.rows.push(this.rowsAr[F])}});this._fixHiddenRowsAll(B,E,"display","none");if(this.isTreeGrid()){this._fixHiddenRowsAllTG(E,"none")}if((_isOpera&&_OperaRv<9)||_isKHTML||(_isFF)){this._fixHiddenRowsAll(this.hdr,E,"display","none","_cellIndexS")}if(this.ftr){this._fixHiddenRowsAll(this.ftr.childNodes[0],E,"display","none")}this._fixHiddenRowsAll(this.hdr,E,"whiteSpace","nowrap","_cellIndexS");if(!this.cellWidthPX.length&&!this.cellWidthPC.length){this.cellWidthPX=[].concat(this.initCellWidth)}if(this.cellWidthPX[E]){this.cellWidthPX[E]=0}if(this.cellWidthPC[E]){this.cellWidthPC[E]=0}}else{if(this.hdr.rows[0].cells[E]._oldWidth){var C=this.hdr.rows[0].cells[E];if(_isOpera||_isKHTML||(_isFF)){this._fixHiddenRowsAll(this.hdr,E,"display","","_cellIndexS")}if(this.ftr){this._fixHiddenRowsAll(this.ftr.childNodes[0],E,"display","")}var B={rows:[this.obj.rows[0]]};this.forEachRow(function(F){if(this.rowsAr[F].tagName=="TR"){B.rows.push(this.rowsAr[F])}});this._fixHiddenRowsAll(B,E,"display","");if(this.isTreeGrid()){this._fixHiddenRowsAllTG(E,"")}this._fixHiddenRowsAll(this.hdr,E,"whiteSpace","normal","_cellIndexS");if(C._oldWidthP){this.cellWidthPC[E]=C._oldWidthP}if(C._oldWidth){this.cellWidthPX[E]=parseInt(C._oldWidth)}}}this.setSizes();if((!_isIE)&&(!_isFF)){this.obj.border=1;this.obj.border=0}},enableColSpan:function(A){this._ecspn=convertStringToBoolean(A)},enableRowsHover:function(B,A){this._unsetRowHover(false,true);this._hvrCss=A;if(convertStringToBoolean(B)){if(!this._elmnh){this.obj._honmousemove=this.obj.onmousemove;this.obj.onmousemove=this._setRowHover;if(_isIE){this.obj.onmouseleave=this._unsetRowHover}else{this.obj.onmouseout=this._unsetRowHover}this._elmnh=true}}else{if(this._elmnh){this.obj.onmousemove=this.obj._honmousemove;if(_isIE){this.obj.onmouseleave=null}else{this.obj.onmouseout=null}this._elmnh=false}}},enableEditEvents:function(B,C,A){this._sclE=convertStringToBoolean(B);this._dclE=convertStringToBoolean(C);this._f2kE=convertStringToBoolean(A)},enableLightMouseNavigation:function(A){if(convertStringToBoolean(A)){if(!this._elmn){this.entBox._onclick=this.entBox.onclick;this.entBox.onclick=function(){return true};this.obj._onclick=this.obj.onclick;this.obj.onclick=function(B){var C=this.grid.getFirstParentOfType(B?B.target:event.srcElement,"TD");if(!C){return }this.grid.editStop();this.grid.doClick(C);this.grid.editCell();(B||event).cancelBubble=true};this.obj._onmousemove=this.obj.onmousemove;this.obj.onmousemove=this._autoMoveSelect;this._elmn=true}}else{if(this._elmn){this.entBox.onclick=this.entBox._onclick;this.obj.onclick=this.obj._onclick;this.obj.onmousemove=this.obj._onmousemove;this._elmn=false}}},_unsetRowHover:function(B,C){if(C){that=this}else{that=this.grid}if((that._lahRw)&&(that._lahRw!=C)){for(var A=0;A<that._lahRw.childNodes.length;A++){that._lahRw.childNodes[A].className=that._lahRw.childNodes[A].className.replace(that._hvrCss,"")}that._lahRw=null}},_setRowHover:function(B){var C=this.grid.getFirstParentOfType(B?B.target:event.srcElement,"TD");if(C&&C.parentNode!=this.grid._lahRw){this.grid._unsetRowHover(0,C);C=C.parentNode;if(!C.idd||C.idd=="__filler__"){return }for(var A=0;A<C.childNodes.length;A++){C.childNodes[A].className+=" "+this.grid._hvrCss}this.grid._lahRw=C}this._honmousemove(B)},_autoMoveSelect:function(A){if(!this.grid.editor){var B=this.grid.getFirstParentOfType(A?A.target:event.srcElement,"TD");if(B.parentNode.idd){this.grid.doClick(B,true,0)}}this._onmousemove(A)},enableDistributedParsing:function(C,A,B){if(convertStringToBoolean(C)){this._ads_count=A||10;this._ads_time=B||250}else{this._ads_count=0}},destructor:function(){this.editStop(true);if(this._sizeTime){this._sizeTime=window.clearTimeout(this._sizeTime)}this.entBox.className=(this.entBox.className||"").replace(/gridbox.*/,"");if(this.formInputs){for(var B=0;B<this.formInputs.length;B++){this.parentForm.removeChild(this.formInputs[B])}}var A;this.xmlLoader=this.xmlLoader.destructor();for(var B=0;B<this.rowsCol.length;B++){if(this.rowsCol[B]){this.rowsCol[B].grid=null}}for(B in this.rowsAr){if(this.rowsAr[B]){this.rowsAr[B]=null}}this.rowsCol=new dhtmlxArray();this.rowsAr=new Array();this.entBox.innerHTML="";var C=function(){};this.entBox.onclick=this.entBox.onmousedown=this.entBox.onbeforeactivate=this.entBox.onbeforedeactivate=this.entBox.onbeforedeactivate=this.entBox.onselectstart=C;this.setSizes=this._update_srnd_view=this.callEvent=C;this.entBox.grid=this.objBox.grid=this.hdrBox.grid=this.obj.grid=this.hdr.grid=null;for(A in this){if((this[A])&&(this[A].m_obj)){this[A].m_obj=null}this[A]=null}if(this==globalActiveDHTMLGridObject){globalActiveDHTMLGridObject=null}return null},getSortingState:function(){var A=new Array();if(this.fldSorted){A[0]=this.fldSorted._cellIndex;A[1]=(this.sortImg.src.indexOf("sort_desc.gif")!=-1)?"des":"asc"}return A},enableAutoHeight:function(C,B,A){this._ahgr=convertStringToBoolean(C);this._ahgrF=convertStringToBoolean(A);this._ahgrM=B||null;if(arguments.length==1){this.objBox.style.overflowY=C?"hidden":"auto"}if(B=="auto"){this._ahgrM=null;this._ahgrMA=true;this._setAutoResize()}},enableStableSorting:function(A){this._sst=convertStringToBoolean(A);this.rowsCol.stablesort=function(F){var E=this.length-1;for(var D=0;D<this.length-1;D++){for(var C=0;C<E;C++){if(F(this[C],this[C+1])>0){var B=this[C];this[C]=this[C+1];this[C+1]=B}}E--}}},enableKeyboardSupport:function(A){this._htkebl=!convertStringToBoolean(A)},enableContextMenu:function(A){this._ctmndx=A},setScrollbarWidthCorrection:function(A){},enableTooltips:function(B){this._enbTts=B.split(",");for(var A=0;A<this._enbTts.length;A++){this._enbTts[A]=convertStringToBoolean(this._enbTts[A])}},enableResizing:function(B){this._drsclmn=B.split(",");for(var A=0;A<this._drsclmn.length;A++){this._drsclmn[A]=convertStringToBoolean(this._drsclmn[A])}},setColumnMinWidth:function(A,B){if(arguments.length==2){if(!this._drsclmW){this._drsclmW=new Array()}this._drsclmW[B]=A}else{this._drsclmW=A.split(",")}},enableCellIds:function(A){this._enbCid=convertStringToBoolean(A)},lockRow:function(A,C){var B=this.getRowById(A);if(B){B._locked=convertStringToBoolean(C);if((this.cell)&&(this.cell.parentNode.idd==A)){this.editStop()}}},_getRowArray:function(D){var C=new Array();for(var B=0;B<D.childNodes.length;B++){var A=this.cells3(D,B);C[B]=A.getValue()}return C},setDateFormat:function(B,A){this._dtmask=B;this._dtmask_inc=A},setNumberFormat:function(H,C,E,G){var D=H.replace(/[^0\,\.]*/g,"");var A=D.indexOf(".");if(A>-1){A=D.length-A-1}var B=D.indexOf(",");if(B>-1){B=D.length-A-2-B}if(typeof E!="string"){E=this.i18n.decimal_separator}if(typeof G!="string"){G=this.i18n.group_separator}var I=H.split(D)[0];var F=H.split(D)[1];this._maskArr[C]=[A,B,I,F,E,G]},_aplNFb:function(D,C){var A=this._maskArr[C];if(!A){return D}var B=parseFloat(D.toString().replace(/[^0-9]*/g,""));if(D.toString().substr(0,1)=="-"){B=B*-1}if(A[0]>0){B=B/Math.pow(10,A[0])}return B},_aplNF:function(D,C){var A=this._maskArr[C];if(!A){return D}var E=(parseFloat(D)<0?"-":"")+A[2];D=Math.abs(Math.round(parseFloat(D)*Math.pow(10,A[0]>0?A[0]:0))).toString();D=(D.length<A[0]?Math.pow(10,A[0]+1-D.length).toString().substr(1,A[0]+1)+D.toString():D).split("").reverse();D[A[0]]=(D[A[0]]||"0")+A[4];if(A[1]>0){for(var B=(A[0]>0?0:1)+A[0]+A[1];B<D.length;B+=A[1]){D[B]+=A[5]}}return E+D.reverse().join("")+A[3]},_launchCommands:function(A){for(var D=0;D<A.length;D++){var C=new Array();for(var B=0;B<A[D].childNodes.length;B++){if(A[D].childNodes[B].nodeType==1){C[C.length]=A[D].childNodes[B].firstChild.data}}this[A[D].getAttribute("command")].apply(this,C)}},_parseHead:function(P){var G=this.xmlLoader.doXPath("./head",P);if(G.length){var B=this.xmlLoader.doXPath("./column",G[0]);var I=this.xmlLoader.doXPath("./settings",G[0]);var J="setInitWidths";var M=false;if(I[0]){for(var Q=0;Q<I[0].childNodes.length;Q++){switch(I[0].childNodes[Q].tagName){case"colwidth":if(I[0].childNodes[Q].firstChild&&I[0].childNodes[Q].firstChild.data=="%"){J="setInitWidthsP"}break;case"splitat":M=(I[0].childNodes[Q].firstChild?I[0].childNodes[Q].firstChild.data:false);break}}}this._launchCommands(this.xmlLoader.doXPath("./beforeInit/call",G[0]));if(B.length>0){if(this.hdr.rows.length>0){this.clearAll(true)}var L=[[],[],[],[],[],[],[],[],[]];var N=["","width","type","align","sort","color","format","hidden","id"];var O=["",J,"setColTypes","setColAlign","setColSorting","setColumnColor","","","setColumnIds"];for(var H=0;H<B.length;H++){for(var F=1;F<N.length;F++){L[F].push(B[H].getAttribute(N[F]))}L[0].push((B[H].firstChild?B[H].firstChild.data:"").replace(/^\s*((\s\S)*.+)\s*$/gi,"$1"))}this.setHeader(L[0]);for(var H=0;H<O.length;H++){if(O[H]){this[O[H]](L[H].join(this.delim))}}for(var H=0;H<B.length;H++){if((this.cellType[H].indexOf("co")==0)||(this.cellType[H]=="clist")){var E=this.xmlLoader.doXPath("./option",B[H]);if(E.length){var A=new Array();if(this.cellType[H]=="clist"){for(var F=0;F<E.length;F++){A[A.length]=E[F].firstChild?E[F].firstChild.data:""}this.registerCList(H,A)}else{var C=this.getCombo(H);for(var F=0;F<E.length;F++){C.put(E[F].getAttribute("value"),E[F].firstChild?E[F].firstChild.data:"")}}}}else{if(L[6][H]){if((this.cellType[H].toLowerCase().indexOf("calendar")!=-1)||(this.fldSort[H]=="date")){this.setDateFormat(L[6][H])}else{this.setNumberFormat(L[6][H],H)}}}}this.init();var D=L[7].join(this.delim);if(this.setColHidden&&D.replace(/,/g,"")!=""){this.setColHidden(D)}if((M)&&(this.splitAt)){this.splitAt(M)}}this._launchCommands(this.xmlLoader.doXPath("./afterInit/call",G[0]))}var K=this.xmlLoader.doXPath("//rows/userdata",P);if(K.length>0){if(!this.UserData.gridglobaluserdata){this.UserData.gridglobaluserdata=new Hashtable()}for(var F=0;F<K.length;F++){this.UserData.gridglobaluserdata.put(K[F].getAttribute("name"),K[F].firstChild?K[F].firstChild.data:"")}}},getCheckedRows:function(A){var B=new Array();this.forEachRowA(function(C){if(this.cells(C,A).getValue()!=0){B.push(C)}},true);return B.join(",")},checkAll:function(){var B=arguments.length?arguments[0]:1;for(var A=0;A<this.getColumnsNum();A++){if(this.getColType(A)=="ch"){this.setCheckedRows(A,B)}}},uncheckAll:function(){this.checkAll(0)},setCheckedRows:function(B,A){this.forEachRowA(function(C){if(this.cells(C,B).isCheckbox()){this.cells(C,B).setValue(A)}})},_drawTooltip:function(D){var E=this.grid.getFirstParentOfType(D?D.target:event.srcElement,"TD");if(!E||((this.grid.editor)&&(this.grid.editor.cell==E))){return true}var C=E.parentNode;if(!C.idd||C.idd=="__filler__"){return }var B=(D?D.target:event.srcElement);if(C.idd==window.unknown){return true}if(!this.grid.callEvent("onMouseOver",[C.idd,E._cellIndex])){return true}if((this.grid._enbTts)&&(!this.grid._enbTts[E._cellIndex])){if(B.title){B.title=""}return true}if(E._cellIndex>=this.grid._cCount){return }var A=this.grid.cells3(C,E._cellIndex);if(!A||!A.cell||!A.cell._attrs){return }if(B._title){A.cell.title=""}if(!A.cell._attrs.title){B._title=true}if(A){B.title=A.cell._attrs.title||(A.getTitle?A.getTitle():(A.getValue()||"").toString().replace(/<[^>]*>/gi,""))}return true},enableCellWidthCorrection:function(A){if(_isFF){this._wcorr=parseInt(A)}},getAllRowIds:function(C){var A=[];for(var B=0;B<this.rowsBuffer.length;B++){if(this.rowsBuffer[B]){A.push(this.rowsBuffer[B].idd)}}return A.join(C||this.delim)},getAllItemIds:function(){return this.getAllRowIds()},setColspan:function(B,K,C){if(!this._ecspn){return }var A=this.getRowById(B);if((A._childIndexes)&&(A.childNodes[A._childIndexes[K]])){var F=A._childIndexes[K];var D=A.childNodes[F];var E=D.colSpan;D.colSpan=1;if((E)&&(E!=1)){for(var H=1;H<E;H++){var J=document.createElement("TD");if(D.nextSibling){A.insertBefore(J,D.nextSibling)}else{A.appendChild(J)}A._childIndexes[K+H]=F+H;J._cellIndex=K+H;J.style.textAlign=this.cellAlign[H];J.style.verticalAlign=this.cellVAlign[H];D=J;this.cells3(A,K+H).setValue("")}}for(var I=K*1+1*E;I<A._childIndexes.length;I++){A._childIndexes[I]+=(E-1)*1}}if((C)&&(C>1)){if(A._childIndexes){var F=A._childIndexes[K]}else{var F=K;A._childIndexes=new Array();for(var I=0;I<A.childNodes.length;I++){A._childIndexes[I]=I}}A.childNodes[F].colSpan=C;for(var I=1;I<C;I++){A._childIndexes[A.childNodes[F+1]._cellIndex]=F;A.removeChild(A.childNodes[F+1])}var G=A.childNodes[A._childIndexes[K]]._cellIndex;for(var I=G*1+1*C;I<A._childIndexes.length;I++){A._childIndexes[I]-=(C-1)}}},preventIECaching:function(A){this.no_cashe=convertStringToBoolean(A);this.xmlLoader.rSeed=this.no_cashe},enableColumnAutoSize:function(A){this._eCAS=convertStringToBoolean(A)},_onHeaderDblClick:function(C){var B=this.grid;var A=B.getFirstParentOfType(_isIE?event.srcElement:C.target,"TD");if(!B._eCAS){return false}B.adjustColumnSize(A._cellIndexS)},adjustColumnSize:function(E,G){if(this._hrrar&&this._hrrar[E]){return }this._notresize=true;var A=0;this._setColumnSizeR(E,20);for(var D=1;D<this.hdr.rows.length;D++){var C=this.hdr.rows[D];C=C.childNodes[(C._childIndexes)?C._childIndexes[E]:E];if((C)&&((!C.colSpan)||(C.colSpan<2))&&C._cellIndex==E){if((C.childNodes[0])&&(C.childNodes[0].className=="hdrcell")){C=C.childNodes[0]}A=Math.max(A,((_isFF||_isOpera)?(C.textContent.length*7):C.scrollWidth))}}var B=this.obj.rows.length;for(var F=1;F<B;F++){var H=this.obj.rows[F];if(!this.rowsAr[H.idd]){continue}if(H._childIndexes&&H._childIndexes[E]!=E||!H.childNodes[E]){continue}if(_isFF||_isOpera||G){H=H.childNodes[E].textContent.length*7}else{H=H.childNodes[E].scrollWidth}if(H>A){A=H}}A+=20+(G||0);this._setColumnSizeR(E,A);this._notresize=false;this.setSizes()},detachHeader:function(A,C){C=C||this.hdr;var B=C.rows[A+1];if(B){B.parentNode.removeChild(B)}this.setSizes()},detachFooter:function(A){this.detachHeader(A,this.ftr)},attachHeader:function(A,D,B){if(typeof (A)=="string"){A=this._eSplit(A)}if(typeof (D)=="string"){D=D.split(this.delim)}B=B||"_aHead";if(this.hdr.rows.length){if(A){this._createHRow([A,D],this[(B=="_aHead")?"hdr":"ftr"])}else{if(this[B]){for(var C=0;C<this[B].length;C++){this.attachHeader.apply(this,this[B][C])}}}}else{if(!this[B]){this[B]=new Array()}this[B][this[B].length]=[A,D,B]}},_createHRow:function(C,J){if(!J){if(this.entBox.style.position!="absolute"){this.entBox.style.position="relative"}var G=document.createElement("DIV");G.className="c_ftr".substr(2);this.entBox.appendChild(G);var M=document.createElement("TABLE");M.cellPadding=M.cellSpacing=0;if(!_isIE){M.width="100%";M.style.paddingRight="20px"}M.style.marginRight="20px";M.style.tableLayout="fixed";G.appendChild(M);M.appendChild(document.createElement("TBODY"));this.ftr=J=M;var F=M.insertRow(0);var A=((this.hdrLabels.length<=1)?C[0].length:this.hdrLabels.length);for(var D=0;D<A;D++){F.appendChild(document.createElement("TH"));F.childNodes[D]._cellIndex=D}if(_isIE&&_isIE<8){F.style.position="absolute"}else{F.style.height="auto"}}var E=C[1];var G=document.createElement("TR");J.rows[0].parentNode.appendChild(G);for(var D=0;D<C[0].length;D++){if(C[0][D]=="#cspan"){var H=G.cells[G.cells.length-1];H.colSpan=(H.colSpan||1)+1;continue}if((C[0][D]=="#rspan")&&(J.rows.length>1)){var O=J.rows.length-2;var N=false;var H=null;while(!N){var H=J.rows[O];for(var B=0;B<H.cells.length;B++){if(H.cells[B]._cellIndex==D){N=B+1;break}}O--}H=H.cells[N-1];H.rowSpan=(H.rowSpan||1)+1;continue}var I=document.createElement("TD");I._cellIndex=I._cellIndexS=D;if(this._hrrar&&this._hrrar[D]&&!_isIE){I.style.display="none"}if(typeof C[0][D]=="object"){I.appendChild(C[0][D])}else{if(this.forceDivInHeader){I.innerHTML="<div class='hdrcell'>"+(C[0][D]||"&nbsp;")+"</div>"}else{I.innerHTML=(C[0][D]||"&nbsp;")}if((C[0][D]||"").indexOf("#")!=-1){var M=C[0][D].match(/(^|{)#([^}]+)(}|$)/);if(M){var K="_in_header_"+M[2];if(this[K]){this[K]((this.forceDivInHeader?I.firstChild:I),D,C[0][D].split(M[0]))}}}}if(E){I.style.cssText=E[D]}G.appendChild(I)}var L=J;if(_isKHTML){if(J._kTimer){window.clearTimeout(J._kTimer)}J._kTimer=window.setTimeout(function(){J.rows[1].style.display="none";window.setTimeout(function(){J.rows[1].style.display=""},1)},500)}},attachFooter:function(A,B){this.attachHeader(A,B,"_aFoot")},setCellExcellType:function(C,A,B){this.changeCellType(this.getRowById(C),A,B)},changeCellType:function(C,D,B){B=B||this.cellType[D];var E=this.cells3(C,D);var A=E.getValue();E.cell._cellType=B;var E=this.cells3(C,D);E.setValue(A)},setRowExcellType:function(C,B){var D=this.rowsAr[C];for(var A=0;A<D.childNodes.length;A++){this.changeCellType(D,A,B)}},setColumnExcellType:function(A,C){for(var B=0;B<this.rowsBuffer.length;B++){if(this.rowsBuffer[B]&&this.rowsBuffer[B].tagName=="TR"){this.changeCellType(this.rowsBuffer[B],A,C)}}if(this.cellType[A]=="math"){this._strangeParams[B]=C}else{this.cellType[A]=C}},forEachRow:function(B){for(var A in this.rowsAr){if(this.rowsAr[A]&&this.rowsAr[A].idd){B.apply(this,[this.rowsAr[A].idd])}}},forEachRowA:function(B){for(var A=0;A<this.rowsBuffer.length;A++){if(this.rowsBuffer[A]){B.call(this,this.render_row(A).idd)}}},forEachCell:function(C,B){var D=this.getRowById(C);if(!D){return }for(var A=0;A<this._cCount;A++){B(this.cells3(D,A),A)}},enableAutoWidth:function(C,A,B){this._awdth=[convertStringToBoolean(C),parseInt(A||99999),parseInt(B||0)];if(arguments.length==1){this.objBox.style.overflowX=C?"hidden":"auto"}},updateFromXML:function(A,D,B,C){if(typeof D=="undefined"){D=true}this._refresh_mode=[true,D,B];this.load(A,C)},_refreshFromXML:function(C){if(this._f_rowsBuffer){this.filterBy(0,"")}reset=false;if(window.eXcell_tree){eXcell_tree.prototype.setValueX=eXcell_tree.prototype.setValue;eXcell_tree.prototype.setValue=function(K){var J=this.grid._h2.get[this.cell.parentNode.idd];if(J&&this.cell.parentNode.valTag){this.setLabel(K)}else{this.setValueX(K)}}}var I=this.cellType._dhx_find("tree");C.getXMLTopNode("rows");var D=C.doXPath("//rows")[0].getAttribute("parent")||0;var F={};if(this._refresh_mode[2]){if(I!=-1){this._h2.forEachChild(D,function(J){F[J.id]=true},this)}else{this.forEachRow(function(J){F[J]=true})}}var H=C.doXPath("//row");for(var B=0;B<H.length;B++){var G=H[B];var A=G.getAttribute("id");F[A]=false;var D=G.parentNode.getAttribute("id")||D;if(this.rowsAr[A]&&this.rowsAr[A].tagName!="TR"){if(this._h2){this._h2.get[A].buff.data=G}else{this.rowsBuffer[this.getRowIndex(A)].data=G}this.rowsAr[A]=G}else{if(this.rowsAr[A]){this._process_xml_row(this.rowsAr[A],G,-1);this._postRowProcessing(this.rowsAr[A],true)}else{if(this._refresh_mode[1]){var E={idd:A,data:G,_parser:this._process_xml_row,_locator:this._get_xml_data};if(this._refresh_mode[1]=="top"){this.rowsBuffer.unshift(E)}else{this.rowsBuffer.push(E)}if(this._h2){reset=true;(this._h2.add(A,(G.parentNode.getAttribute("id")||G.parentNode.getAttribute("parent")))).buff=this.rowsBuffer[this.rowsBuffer.length-1]}this.rowsAr[A]=G;G=this.render_row(this.rowsBuffer.length-1);this._insertRowAt(G,-1)}}}}if(this._refresh_mode[2]){for(A in F){if(F[A]&&this.rowsAr[A]){this.deleteRow(A)}}}this._refresh_mode=null;if(window.eXcell_tree){eXcell_tree.prototype.setValue=eXcell_tree.prototype.setValueX}if(reset){this._renderSort()}if(this._f_rowsBuffer){this._f_rowsBuffer=null;this.filterByAll()}},getCustomCombo:function(C,B){var A=this.cells(C,B).cell;if(!A._combo){A._combo=new dhtmlXGridComboObject()}return A._combo},setTabOrder:function(B){var D=B.split(this.delim);this._tabOrder=[];var A=this._cCount||B.length;for(var C=0;C<A;C++){D[C]={c:parseInt(D[C]),ind:C}}D.sort(function(F,E){return(F.c>E.c?1:-1)});for(var C=0;C<A;C++){if(!D[C+1]||(typeof D[C].c=="undefined")){this._tabOrder[D[C].ind]=(D[0].ind+1)*-1}else{this._tabOrder[D[C].ind]=D[C+1].ind}}},i18n:{loading:"Loading",decimal_separator:".",group_separator:","},_key_events:{k13_1_0:function(){var A=this.rowsCol._dhx_find(this.row);this.selectCell(this.rowsCol[A+1],this.cell._cellIndex,true)},k13_0_1:function(){var A=this.rowsCol._dhx_find(this.row);this.selectCell(this.rowsCol[A-1],this.cell._cellIndex,true)},k13_0_0:function(){this.editStop();this.callEvent("onEnter",[(this.row?this.row.idd:null),(this.cell?this.cell._cellIndex:null)]);this._still_active=true},k9_0_0:function(){this.editStop();if(!this.callEvent("onTab",[true])){return true}var A=this._getNextCell(null,1);if(A){this.selectCell(A.parentNode,A._cellIndex,(this.row!=A.parentNode),false,true);this._still_active=true}},k9_0_1:function(){this.editStop();if(!this.callEvent("onTab",[false])){return false}var A=this._getNextCell(null,-1);if(A){this.selectCell(A.parentNode,A._cellIndex,(this.row!=A.parentNode),false,true);this._still_active=true}},k113_0_0:function(){if(this._f2kE){this.editCell()}},k32_0_0:function(){var A=this.cells4(this.cell);if(!A.changeState||(A.changeState()===false)){return false}},k27_0_0:function(){this.editStop(true)},k33_0_0:function(){if(this.pagingOn){this.changePage(this.currentPage-1)}else{this.scrollPage(-1)}},k34_0_0:function(){if(this.pagingOn){this.changePage(this.currentPage+1)}else{this.scrollPage(1)}},k37_0_0:function(){if(!this.editor&&this.isTreeGrid()){this.collapseKids(this.row)}else{return false}},k39_0_0:function(){if(!this.editor&&this.isTreeGrid()){this.expandKids(this.row)}else{return false}},k40_0_0:function(){var B=this._realfake?this._fake:this;if(this.editor&&this.editor.combo){this.editor.shiftNext()}else{if(!this.row.idd){return }var A=Math.max((B._r_select||0),this.getRowIndex(this.row.idd))+1;if(this.rowsBuffer[A]){B._r_select=null;this.selectCell(A,this.cell._cellIndex,true);if(B.pagingOn){B.showRow(B.getRowId(A))}}else{this._key_events.k34_0_0.apply(this,[]);if(this.pagingOn&&this.rowsCol[A]){this.selectCell(A,0,true)}}}this._still_active=true},k38_0_0:function(){var B=this._realfake?this._fake:this;if(this.editor&&this.editor.combo){this.editor.shiftPrev()}else{if(!this.row.idd){return }var A=this.getRowIndex(this.row.idd)+1;if(A!=-1&&(!this.pagingOn||(A!=1))){var C=this._nextRow(A-1,-1);this.selectCell(C,this.cell._cellIndex,true);if(B.pagingOn&&C){B.showRow(C.idd)}}else{this._key_events.k33_0_0.apply(this,[])}}this._still_active=true}},_build_master_row:function(){var C=document.createElement("DIV");var B=["<table><tr>"];for(var A=0;A<this._cCount;A++){B.push("<td></td>")}B.push("</tr></table>");C.innerHTML=B.join("");this._master_row=C.firstChild.rows[0]},_prepareRow:function(A){if(!this._master_row){this._build_master_row()}var C=this._master_row.cloneNode(true);for(var B=0;B<C.childNodes.length;B++){C.childNodes[B]._cellIndex=B;if(this._enbCid){C.childNodes[B].id="c_"+A+"_"+B}if(this.dragAndDropOff){this.dragger.addDraggableItem(C.childNodes[B],this)}}C.idd=A;C.grid=this;return C},_process_jsarray_row:function(B,C){B._attrs={};for(var A=0;A<B.childNodes.length;A++){B.childNodes[A]._attrs={}}this._fillRow(B,(this._c_order?this._swapColumns(C):C));return B},_get_jsarray_data:function(B,A){return B[A]},_process_json_row:function(B,C){B._attrs={};for(var A=0;A<B.childNodes.length;A++){B.childNodes[A]._attrs={}}this._fillRow(B,(this._c_order?this._swapColumns(C.data):C.data));return B},_get_json_data:function(B,A){return B.data[A]},_process_csv_row:function(B,C){B._attrs={};for(var A=0;A<B.childNodes.length;A++){B.childNodes[A]._attrs={}}this._fillRow(B,(this._c_order?this._swapColumns(C.split(this.csv.cell)):C.split(this.csv.cell)));return B},_get_csv_data:function(B,A){return B.split(this.csv.cell)[A]},_process_xml_row:function(A,F){var J=this.xmlLoader.doXPath(this.xml.cell,F);var H=[];A._attrs=this._xml_attrs(F);if(this._ud_enabled){var I=this.xmlLoader.doXPath("./userdata",F);for(var D=I.length-1;D>=0;D--){this.setUserData(A.idd,I[D].getAttribute("name"),I[D].firstChild?I[D].firstChild.data:"")}}for(var C=0;C<J.length;C++){var E=J[this._c_order?this._c_order[C]:C];if(!E){continue}var B=A._childIndexes?A._childIndexes[C]:C;var G=E.getAttribute("type");if(A.childNodes[B]){if(G){A.childNodes[B]._cellType=G}A.childNodes[B]._attrs=this._xml_attrs(E)}if(!E.getAttribute("xmlcontent")){if(E.firstChild){E=E.firstChild.data}else{E=""}}H.push(E)}for(C<J.length;C<A.childNodes.length;C++){A.childNodes[C]._attrs={}}if(A.parentNode&&A.parentNode.tagName=="row"){A._attrs.parent=A.parentNode.getAttribute("idd")}this._fillRow(A,H);return A},_get_xml_data:function(B,A){B=B.firstChild;while(true){if(!B){return""}if(B.tagName=="cell"){A--}if(A<0){break}B=B.nextSibling}return(B.firstChild?B.firstChild.data:"")},_fillRow:function(D,F){if(this.editor){this.editStop()}for(var B=0;B<D.childNodes.length;B++){if((B<F.length)||(this.defVal[B])){var C=D.childNodes[B]._cellIndex;var E=F[C];var A=this.cells4(D.childNodes[B]);if((this.defVal[C])&&((E=="")||(typeof (E)=="undefined"))){E=this.defVal[C]}if(A){A.setValue(E)}}else{D.childNodes[B].innerHTML="&nbsp;";D.childNodes[B]._clearCell=true}}return D},_postRowProcessing:function(E,G){if(E._attrs["class"]){E._css=E.className=E._attrs["class"]}if(E._attrs.locked){E._locked=true}if(E._attrs.bgColor){E.bgColor=E._attrs.bgColor}var F=0;for(var B=0;B<E.childNodes.length;B++){var H=E.childNodes[B];var D=H._cellIndex;var C=H._attrs.style||E._attrs.style;if(C){H.style.cssText+=";"+C}if(H._attrs["class"]){H.className=H._attrs["class"]}C=H._attrs.align||this.cellAlign[D];if(C){H.align=C}H.vAlign=H._attrs.valign||this.cellVAlign[D];var A=H._attrs.bgColor||this.columnColor[D];if(A){H.bgColor=A}if(H._attrs.colspan&&!G){this.setColspan(E.idd,B+F,H._attrs.colspan);F+=(H._attrs.colspan-1)}if(this._hrrar&&this._hrrar[D]&&!G){H.style.display="none"}}this.callEvent("onRowCreated",[E.idd,E,null])},load:function(A,C,B){this.callEvent("onXLS",[this]);if(arguments.length==2&&typeof C!="function"){B=C;C=null}B=B||"xml";if(!this.xmlFileUrl){this.xmlFileUrl=A}this._data_type=B;this.xmlLoader.onloadAction=function(F,D,H,G,E){E=F["_process_"+B](E);if(!F._contextCallTimer){F.callEvent("onXLE",[F,0,0,E])}if(C){C();C=null}};this.xmlLoader.loadXML(A)},loadXMLString:function(C,B){var A=new dtmlXMLLoaderObject(function(){});A.loadXMLString(C);this.parse(A,B,"xml")},loadXML:function(A,B){this.load(A,B,"xml")},parse:function(C,B,A){if(arguments.length==2&&typeof B!="function"){A=B;B=null}A=A||"xml";this._data_type=A;C=this["_process_"+A](C);if(!this._contextCallTimer){this.callEvent("onXLE",[this,0,0,C])}if(B){B()}},xml:{top:"rows",row:"./row",cell:"./cell",s_row:"row",s_cell:"cell",row_attrs:[],cell_attrs:[]},csv:{row:"\n",cell:","},_xml_attrs:function(B){var C={};if(B.attributes.length){for(var A=0;A<B.attributes.length;A++){C[B.attributes[A].name]=B.attributes[A].value}}return C},_process_xml:function(A){if(!A.doXPath){var C=new dtmlXMLLoaderObject(function(){});if(typeof A=="string"){C.loadXMLString(A)}else{if(A.responseXML){C.xmlDoc=A}else{C.xmlDoc={}}C.xmlDoc.responseXML=A}A=C}if(this._refresh_mode){return this._refreshFromXML(A)}this._parsing=true;var G=A.getXMLTopNode(this.xml.top);if(G.tagName.toLowerCase()!=this.xml.top){return }this._parseHead(G);var F=A.doXPath(this.xml.row,G);var E=parseInt(A.doXPath("//"+this.xml.top)[0].getAttribute("pos")||0);var D=parseInt(A.doXPath("//"+this.xml.top)[0].getAttribute("total_count")||0);if(D&&!this.rowsBuffer[D-1]){this.rowsBuffer[D-1]=null}if(this.isTreeGrid()){return this._process_tree_xml(A)}for(var B=0;B<F.length;B++){if(this.rowsBuffer[B+E]){continue}var H=F[B].getAttribute("id")||(B+E+1);this.rowsBuffer[B+E]={idd:H,data:F[B],_parser:this._process_xml_row,_locator:this._get_xml_data};this.rowsAr[H]=F[B]}this.render_dataset();this._parsing=false;return A.xmlDoc.responseXML?A.xmlDoc.responseXML:A.xmlDoc},_process_jsarray:function(data){this._parsing=true;if(data&&data.xmlDoc){eval("data="+data.xmlDoc.responseText+";")}for(var i=0;i<data.length;i++){var id=i+1;this.rowsBuffer.push({idd:id,data:data[i],_parser:this._process_jsarray_row,_locator:this._get_jsarray_data});this.rowsAr[id]=data[i]}this.render_dataset();this._parsing=false},_process_csv:function(D){this._parsing=true;if(D.xmlDoc){D=D.xmlDoc.responseText}D=D.replace(/\r/g,"");D=D.split(this.csv.row);if(this._csvHdr){this.clearAll();var C=D.splice(0,1)[0].split(this.csv.cell);if(!this._csvAID){C.splice(0,1)}this.setHeader(C.join(this.delim));this.init()}for(var B=0;B<D.length;B++){if(!D[B]&&B==D.length-1){continue}if(this._csvAID){var E=B+1;this.rowsBuffer.push({idd:E,data:D[B],_parser:this._process_csv_row,_locator:this._get_csv_data})}else{var A=D[B].split(this.csv.cell);var E=A.splice(0,1)[0];this.rowsBuffer.push({idd:E,data:A,_parser:this._process_jsarray_row,_locator:this._get_jsarray_data})}this.rowsAr[E]=D[B]}this.render_dataset();this._parsing=false},_process_json:function(data){this._parsing=true;if(data&&data.xmlDoc){eval("data="+data.xmlDoc.responseText+";")}for(var i=0;i<data.rows.length;i++){var id=data.rows[i].id;this.rowsBuffer.push({idd:id,data:data.rows[i],_parser:this._process_json_row,_locator:this._get_json_data});this.rowsAr[id]=data[i]}this.render_dataset();this._parsing=false},render_dataset:function(C,A){if(this._srnd){if(this._fillers){return this._update_srnd_view()}A=Math.min((this._get_view_size()+(this._srnd_pr||0)),this.rowsBuffer.length)}if(this.pagingOn){C=Math.max((C||0),(this.currentPage-1)*this.rowsBufferOutSize);A=Math.min(this.currentPage*this.rowsBufferOutSize,this.rowsBuffer.length)}else{C=C||0;A=A||this.rowsBuffer.length}for(var B=C;B<A;B++){var E=this.render_row(B);if(E==-1){if(this.xmlFileUrl){if(this.callEvent("onDynXLS",[B,(this._dpref?this._dpref:(A-B))])){this.load(this.xmlFileUrl+getUrlSymbol(this.xmlFileUrl)+"posStart="+B+"&count="+(this._dpref?this._dpref:(A-B)),this._data_type)}}A=B;break}if(!E.parentNode||!E.parentNode.tagName){this._insertRowAt(E,B);if(E._attrs.selected||E._attrs.select){this.selectRow(E,E._attrs.call?true:false,true);E._attrs.selected=E._attrs.select=null}}if(this._ads_count&&B-C==this._ads_count){var D=this;this._context_parsing=this._context_parsing||this._parsing;return this._contextCallTimer=window.setTimeout(function(){D._contextCallTimer=null;D.render_dataset(B,A);if(!D._contextCallTimer){if(D._context_parsing){D.callEvent("onXLE",[])}else{D._fixAlterCss()}D.callEvent("onDistributedEnd",[]);D._context_parsing=false}},this._ads_time)}}if(this._srnd&&!this._fillers){this._fillers=[this._add_filler(A,this.rowsBuffer.length-A)]}this.setSizes()},render_row:function(B){if(!this.rowsBuffer[B]){return -1}if(this.rowsBuffer[B]._parser){var A=this.rowsBuffer[B];if(this.rowsAr[A.idd]&&this.rowsAr[A.idd].tagName=="TR"){return this.rowsBuffer[B]=this.rowsAr[A.idd]}var C=this._prepareRow(A.idd);this.rowsBuffer[B]=C;this.rowsAr[A.idd]=C;A._parser.call(this,C,A.data);this._postRowProcessing(C);return C}return this.rowsBuffer[B]},_get_cell_value:function(B,A,C){if(B._locator){if(this._c_order){A=this._c_order[A]}return B._locator.call(this,B.data,A)}return this.cells3(B,A)[C?C:"getValue"]()},sortRows:function(C,F,B){B=(B||"asc").toLowerCase();F=(F||this.fldSort[C]);C=C||0;if(this.isTreeGrid()){this.sortTreeRows(C,F,B)}else{var A={};var E=this.cellType[C];var G="getValue";if(E=="link"){G="getContent"}if(E=="dhxCalendar"||E=="dhxCalendarA"){G="getDate"}for(var D=0;D<this.rowsBuffer.length;D++){A[this.rowsBuffer[D].idd]=this._get_cell_value(this.rowsBuffer[D],C,G)}this._sortRows(C,F,B,A)}this.callEvent("onAfterSorting",[C,F,B])},_sortCore:function(C,F,B,A,E){var D="sort";if(this._sst){E.stablesort=this.rowsCol.stablesort;D="stablesort"}if(F.length>4){F=window[F]}if(F=="cus"){var G=this._customSorts[C];E[D](function(I,H){return G(A[I.idd],A[H.idd],B,I.idd,H.idd)})}else{if(typeof (F)=="function"){E[D](function(I,H){return F(A[I.idd],A[H.idd],B,I.idd,H.idd)})}else{if(F=="str"){E[D](function(I,H){if(B=="asc"){return A[I.idd]>A[H.idd]?1:-1}else{return A[I.idd]<A[H.idd]?1:-1}})}else{if(F=="int"){E[D](function(J,I){var H=parseFloat(A[J.idd]);H=isNaN(H)?-99999999999999:H;var K=parseFloat(A[I.idd]);K=isNaN(K)?-99999999999999:K;if(B=="asc"){return H-K}else{return K-H}})}else{if(F=="date"){E[D](function(J,I){var H=Date.parse(A[J.idd])||(Date.parse("01/01/1900"));var K=Date.parse(A[I.idd])||(Date.parse("01/01/1900"));if(B=="asc"){return H-K}else{return K-H}})}}}}}},_sortRows:function(C,D,B,A){this._sortCore(C,D,B,A,this.rowsBuffer);this._reset_view();this.callEvent("onGridReconstructed",[])},_reset_view:function(C){if(!this.obj.rows[0]){return }var A=this.obj.rows[0].parentNode;var D=A.removeChild(A.childNodes[0],true);if(_isKHTML){for(var B=A.parentNode.childNodes.length-1;B>=0;B--){if(A.parentNode.childNodes[B].tagName=="TR"){A.parentNode.removeChild(A.parentNode.childNodes[B],true)}}}else{if(_isIE){for(var B=A.childNodes.length-1;B>=0;B--){A.childNodes[B].removeNode(true)}}else{A.innerHTML=""}}A.appendChild(D);this.rowsCol=dhtmlxArray();if(this._sst){this.enableStableSorting(true)}this._fillers=this.undefined;if(!C){if(_isIE&&this._srnd){this.render_dataset()}else{this.render_dataset()}}},deleteRow:function(B,D){if(!D){D=this.getRowById(B)}if(!D){return }this.editStop();if(!this._realfake){if(this.callEvent("onBeforeRowDeleted",[B])==false){return false}}var A=0;if(this.cellType._dhx_find("tree")!=-1&&!this._realfake){A=this._h2.get[B].parent.id;this._removeTrGrRow(D)}else{if(D.parentNode){D.parentNode.removeChild(D)}var F=this.rowsCol._dhx_find(D);if(F!=-1){this.rowsCol._dhx_removeAt(F)}for(var C=0;C<this.rowsBuffer.length;C++){if(this.rowsBuffer[C]&&this.rowsBuffer[C].idd==B){this.rowsBuffer._dhx_removeAt(C);F=C;break}}}this.rowsAr[B]=null;for(var C=0;C<this.selectedRows.length;C++){if(this.selectedRows[C].idd==B){this.selectedRows._dhx_removeAt(C)}}if(this._srnd){for(var C=0;C<this._fillers.length;C++){var E=this._fillers[C];if(!E){continue}if(E[0]>=F){E[0]=E[0]-1}else{if(E[1]>=F){E[1]=E[1]-1}}}this._update_srnd_view()}if(this.pagingOn){this.changePage()}if(!this._realfake){this.callEvent("onAfterRowDeleted",[B,A])}this.callEvent("onGridReconstructed",[]);if(this._ahgr){this.setSizes()}return true},_addRow:function(A,H,F){if(F==-1||typeof F=="undefined"){F=this.rowsBuffer.length}if(typeof H=="string"){H=H.split(this.delim)}var G=this._prepareRow(A);G._attrs={};for(var B=0;B<G.childNodes.length;B++){G.childNodes[B]._attrs={}}this.rowsAr[G.idd]=G;if(this._h2){this._h2.get[G.idd].buff=G}this._fillRow(G,H);this._postRowProcessing(G);if(this._skipInsert){this._skipInsert=false;return this.rowsAr[G.idd]=G}if(this.pagingOn){this.rowsBuffer._dhx_insertAt(F,G);this.rowsAr[G.idd]=G;return G}if(this._fillers){this.rowsCol._dhx_insertAt(F,null);this.rowsBuffer._dhx_insertAt(F,G);if(this._fake){this._fake.rowsCol._dhx_insertAt(F,null)}this.rowsAr[G.idd]=G;var E=false;for(var C=0;C<this._fillers.length;C++){var D=this._fillers[C];if(D&&D[0]<=F&&(D[0]+D[1])>=F){D[1]=D[1]+1;D[2].firstChild.style.height=parseInt(D[2].firstChild.style.height)+this._srdh+"px";E=true;if(this._fake){this._fake._fillers[C][1]++}}if(D&&D[0]>F){D[0]=D[0]+1;if(this._fake){this._fake._fillers[C][0]++}}}if(!E){this._fillers.push(this._add_filler(F,1,(F==0?{parentNode:this.obj.rows[0].parentNode,nextSibling:(this.rowsCol[1])}:this.rowsCol[F-1])))}return G}this.rowsBuffer._dhx_insertAt(F,G);return this._insertRowAt(G,F)},addRow:function(A,D,C){var B=this._addRow(A,D,C);if(!this.dragContext){this.callEvent("onRowAdded",[A])}if(this.pagingOn){this.changePage(this.currentPage)}if(this._srnd){this._update_srnd_view()}B._added=true;if(this._ahgr){this.setSizes()}this.callEvent("onGridReconstructed",[]);return B},_insertRowAt:function(B,C,A){this.rowsAr[B.idd]=B;if(this._skipInsert){this._skipInsert=false;return B}if((C<0)||((!C)&&(parseInt(C)!==0))){C=this.rowsCol.length}else{if(C>this.rowsCol.length){C=this.rowsCol.length}}if(this._cssEven){if((this._cssSP?this.getLevel(B.idd):C)%2==1){B.className+=" "+this._cssUnEven+(this._cssSU?(" "+this._cssUnEven+"_"+this.getLevel(B.idd)):"")}else{B.className+=" "+this._cssEven+(this._cssSU?(" "+this._cssEven+"_"+this.getLevel(B.idd)):"")}}if(!A){if((C==(this.obj.rows.length-1))||(!this.rowsCol[C])){if(_isKHTML){this.obj.appendChild(B)}else{this.obj.firstChild.appendChild(B)}}else{this.rowsCol[C].parentNode.insertBefore(B,this.rowsCol[C])}}this.rowsCol._dhx_insertAt(C,B);return B},getRowById:function(C){var B=this.rowsAr[C];if(B){if(B.tagName!="TR"){for(var A=0;A<this.rowsBuffer.length;A++){if(this.rowsBuffer[A]&&this.rowsBuffer[A].idd==C){return this.render_row(A)}}if(this._h2){return this.render_row(null,B.idd)}}return B}return null},cellById:function(B,A){return this.cells(B,A)},cells:function(C,B){if(arguments.length==0){return this.cells4(this.cell)}else{var D=this.getRowById(C)}var A=(D._childIndexes?D.childNodes[D._childIndexes[B]]:D.childNodes[B]);return this.cells4(A)},cellByIndex:function(B,A){return this.cells2(B,A)},cells2:function(C,B){var D=this.render_row(C);var A=(D._childIndexes?D.childNodes[D._childIndexes[B]]:D.childNodes[B]);return this.cells4(A)},cells3:function(C,B){var A=(C._childIndexes?C.childNodes[C._childIndexes[B]]:C.childNodes[B]);return this.cells4(A)},cells4:function(A){var B=window["eXcell_"+(A._cellType||this.cellType[A._cellIndex])];if(B){return new B(A)}},cells5:function(A,C){var C=C||(A._cellType||this.cellType[A._cellIndex]);if(!this._ecache[C]){if(!window["eXcell_"+C]){var B=eXcell_ro}else{var B=window["eXcell_"+C]}this._ecache[C]=new B(A)}this._ecache[C].cell=A;return this._ecache[C]},dma:function(A){if(!this._ecache){this._ecache={}}if(A&&!this._dma){this._dma=this.cells4;this.cells4=this.cells5}else{if(!A&&this._dma){this.cells4=this._dma;this._dma=null}}},getRowsNum:function(){return this.rowsBuffer.length},enableEditTabOnly:function(A){if(arguments.length>0){this.smartTabOrder=convertStringToBoolean(A)}else{this.smartTabOrder=true}},setExternalTabOrder:function(C,A){var B=this;this.tabStart=(typeof (C)=="object")?C:document.getElementById(C);this.tabStart.onkeydown=function(E){var D=(E||window.event);if(D.keyCode==9){D.cancelBubble=true;B.selectCell(0,0,0,0,1);if(B.smartTabOrder&&B.cells2(0,0).isDisabled()){B._key_events.k9_0_0.call(B)}this.blur();return false}};if(_isOpera){this.tabStart.onkeypress=this.tabStart.onkeydown}this.tabEnd=(typeof (A)=="object")?A:document.getElementById(A);this.tabEnd.onkeydown=this.tabEnd.onkeypress=function(E){var D=(E||window.event);if((D.keyCode==9)&&D.shiftKey){D.cancelBubble=true;B.selectCell((B.getRowsNum()-1),(B.getColumnCount()-1),0,0,1);if(B.smartTabOrder&&B.cells2((B.getRowsNum()-1),(B.getColumnCount()-1)).isDisabled()){B._key_events.k9_0_1.call(B)}this.blur();return false}};if(_isOpera){this.tabEnd.onkeypress=this.tabEnd.onkeydown}},uid:function(){if(!this._ui_seed){this._ui_seed=(new Date()).valueOf()}return this._ui_seed++},clearAndLoad:function(){var A=this._pgn_skin;this._pgn_skin=null;this.clearAll();this._pgn_skin=A;this.load.apply(this,arguments)},getStateOfView:function(){if(this.pagingOn){var A=(this.currentPage-1)*this.rowsBufferOutSize;return[this.currentPage,A,Math.min(A+this.rowsBufferOutSize,this.rowsBuffer.length),this.rowsBuffer.length]}return[Math.floor(this.objBox.scrollTop/this._srdh),Math.ceil(parseInt(this.objBox.offsetHeight)/this._srdh),this.rowsBuffer.length]}};(function(){function D(G,H){this[G]=H}function F(G,H){this[G].call(this,H)}function C(G,H){this[G].call(this,H.join(this.delim))}function A(G,J){for(var I=0;I<J.length;I++){if(typeof J[I]=="object"){var K=this.getCombo(I);for(var H in J[I]){K.put(H,J[I][H])}}}}function E(G,N,J){var P=1;var M=[];function O(R,Q,S){if(!M[Q]){M[Q]=[]}if(typeof S=="object"){S.toString=function(){return this.text}}M[Q][R]=S}for(var K=0;K<N.length;K++){if(typeof (N[K])=="object"&&N[K].length){for(var I=0;I<N[K].length;I++){O(K,I,N[K][I])}}else{O(K,0,N[K])}}for(var K=0;K<M.length;K++){for(var I=0;I<M[0].length;I++){var L=M[K][I];M[K][I]=(L||"").toString()||"&nbsp;";if(L&&L.colspan){for(var H=1;H<L.colspan;H++){O(I+H,K,"#cspan")}}if(L&&L.rowspan){for(var H=1;H<L.rowspan;H++){O(I,K+H,"#rspan")}}}}this.setHeader(M[0]);for(var K=1;K<M.length;K++){this.attachHeader(M[K])}}var B=[{name:"label",def:"&nbsp;",operation:"setHeader",type:E},{name:"id",def:"",operation:"columnIds",type:D},{name:"width",def:"*",operation:"setInitWidths",type:C},{name:"align",def:"left",operation:"cellAlign",type:D},{name:"valign",def:"middle",operation:"cellVAlign",type:D},{name:"sort",def:"na",operation:"fldSort",type:D},{name:"type",def:"ro",operation:"setColTypes",type:C},{name:"options",def:"",operation:"",type:A}];dhtmlx.extend_api("dhtmlXGridObject",{_init:function(G){return[G.parent]},image_path:"setImagePath",columns:"columns",rows:"rows",headers:"headers",skin:"setSkin",smart_rendering:"enableSmartRendering",css:"enableAlterCss",auto_height:"enableAutoHeight",save_hidden:"enableAutoHiddenColumnsSaving",save_cookie:"enableAutoSaving",save_size:"enableAutoSizeSaving",auto_width:"enableAutoWidth",block_selection:"enableBlockSelection",csv_id:"enableCSVAutoID",csv_header:"enableCSVHeader",cell_ids:"enableCellIds",colspan:"enableColSpan",column_move:"enableColumnMove",context_menu:"enableContextMenu",distributed:"enableDistributedParsing",drag:"enableDragAndDrop",drag_order:"enableDragOrder",tabulation:"enableEditTabOnly",header_images:"enableHeaderImages",header_menu:"enableHeaderMenu",keymap:"enableKeyboardSupport",mouse_navigation:"enableLightMouseNavigation",markers:"enableMarkedCells",math_editing:"enableMathEditing",math_serialization:"enableMathSerialization",drag_copy:"enableMercyDrag",multiline:"enableMultiline",multiselect:"enableMultiselect",save_column_order:"enableOrderSaving",hover:"enableRowsHover",rowspan:"enableRowspan",smart:"enableSmartRendering",save_sorting:"enableSortingSaving",stable_sorting:"enableStableSorting",undo:"enableUndoRedo",csv_cell:"setCSVDelimiter",date_format:"setDateFormat",drag_behavior:"setDragBehavior",editable:"setEditable",without_header:"setNoHeader",submit_changed:"submitOnlyChanged",submit_serialization:"submitSerialization",submit_selected:"submitOnlySelected",submit_id:"submitOnlyRowID",xml:"load"},{columns:function(K){for(var G=0;G<B.length;G++){var J=[];for(var H=0;H<K.length;H++){J[H]=K[H][B[G].name]||B[G].def}var I=B[G].type||F;I.call(this,B[G].operation,J,K)}this.init()},rows:function(G){},headers:function(H){for(var G=0;G<H.length;G++){this.attachHeader(H[G])}}})})();